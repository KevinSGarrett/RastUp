{"id": "WBS-4.1", "root": "WBS-4", "source": "NT", "title": "Models", "status": "todo", "agent": null, "priority": 100, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-4.2", "root": "WBS-4", "source": "NT", "title": "Photographers", "status": "todo", "agent": null, "priority": 101, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-4.3", "root": "WBS-4", "source": "NT", "title": "Videographers", "status": "todo", "agent": null, "priority": 102, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-4.4", "root": "WBS-4", "source": "NT", "title": "Content Creators / Influencers", "status": "todo", "agent": null, "priority": 103, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-2.1", "root": "WBS-2", "source": "NT", "title": "Market Research & City Selection", "status": "todo", "agent": null, "priority": 104, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-2.2", "root": "WBS-2", "source": "NT", "title": "Launch Team & Local Operations Setup", "status": "todo", "agent": null, "priority": 105, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-2.3", "root": "WBS-2", "source": "NT", "title": "Localized Marketing & Customer Acquisition Strategy", "status": "todo", "agent": null, "priority": 106, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-2.4", "root": "WBS-2", "source": "NT", "title": "Launch Timeline & Milestones", "status": "todo", "agent": null, "priority": 107, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-2.5", "root": "WBS-2", "source": "NT", "title": "Post-Launch Monitoring & Scaling Strategy", "status": "todo", "agent": null, "priority": 108, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.14.2.2", "root": "WBS-1", "source": "TD", "title": "DynamoDB (hot‑path caches)fansub_entitlement_cache item shape:{", "status": "todo", "agent": null, "priority": 109, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.3", "root": "WBS-1", "source": "TD", "title": "Faceted Navigation, Pagination & FiltersObjective: Let users filter richly without creating an indexation explosion.ApproachIndexable landing per role/city without filters (e.g., /models?city=houston).Non‑indexable filter combinations (e.g., price/amenities) → keep crawlable links but serve noindex, follow and self‑canonical to the landing variant.Pagination: ?page=2 allowed but noindex; canonical to page 1 landing. Avoid rel=prev/next (deprecated); use strong internal links instead.Artifact — filter allowlist", "status": "todo", "agent": null, "priority": 110, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.4", "root": "WBS-1", "source": "TD", "title": "Structured Data (JSON‑LD) — Full CoverageEntity → schema.org type mapPeople (Service Profiles): Person + Offer(s) for packages; optional AggregateRating when policy allows.Studios: LocalBusiness with amenityFeature; optional AggregateRating.Case Studies/Guides: Article/CreativeWork.Breadcrumbs: BreadcrumbList on all public pages.Search results (optional enhancement): ItemList on landing pages.ArtifactsA) BreadcrumbList", "status": "todo", "agent": null, "priority": 111, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.7", "root": "WBS-1", "source": "TD", "title": "Performance for SEO (CWV‑first Build)Budgets (mobile P75): LCP ≤ 2.5s, CLS ≤ 0.10, INP ≤ 200ms, TTFB ≤ 800ms.TacticsPick an LCP element (hero image) per template; preload it with as=image and fetchpriority=\"high\".Inline critical CSS; defer the rest; no blocking fonts (local WOFF2 + font-display: swap).Code‑split heavy widgets; ship minimal JS on public pages.Preconnect only to our CDN and Stripe (checkout only).Serve stale‑while‑revalidate via ISR + CloudFront.Use first‑party analytics via sendBeacon (no third‑party bloat).Artifact — Lighthouse CI budget", "status": "todo", "agent": null, "priority": 112, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.8", "root": "WBS-1", "source": "TD", "title": "Internationalization (hreflang) & LocalizationLaunch locale: en‑US; all public pages must set <html lang=\"en\">.Hreflang scaffolding in head for future locales; keep canonical without locale in path; add <link rel=\"alternate\" hreflang=\"…\"> once translations ship.Localize currency/date/number rendering server‑side for public pages; keep URLs stable.Artifact — hreflang helper", "status": "todo", "agent": null, "priority": 113, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.9", "root": "WBS-1", "source": "TD", "title": "Accessibility (A11y) Synergy for SEOSemantic structure (landmarks, headings) and visible focus.Keyboard‑reachable filters/maps; ARIA for tabs/carousels.Image alt as above; captions/transcripts on videos.Error pages with clear next actions; readable contrast (≥4.5:1 body text).1.17.10 Sitemaps (Web, Image, Video)StrategyIndex file /sitemap.xml linking to segmented sitemaps (People A‑Z, Studios by city, Case Studies, Cities).Image sitemaps for people/studios (SFW thumbnails only).Video sitemap for case studies with videos.Artifact — Image sitemap entry (template)", "status": "todo", "agent": null, "priority": 114, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.11", "root": "WBS-1", "source": "TD", "title": "Internal Linking & BreadcrumbsBreadcrumbs everywhere (Home → City → Role → Entity).In‑content cross‑links:On profiles: “Similar in {City}”, “Studios with {Amenity}”On studios: “People recently booked here”Avoid link farms; keep blocks 3–8 items; deterministic selection.1.17.12 Log‑File Analysis & Search Console IngestionExport edge logs (CloudFront) + app access logs to S3; model into Athena (§1.13).Build crawl dashboard: hits by bot UA, 200/3xx/4xx, coverage of sitemaps, crawl waste on non‑indexable pages.Ingest GSC performance/coverage via API to the lake; build SEO funnel (impressions→clicks→profile views→checkout).Artifact — Athena table (simplified)", "status": "todo", "agent": null, "priority": 115, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.13", "root": "WBS-1", "source": "TD", "title": "SEO‑Safe ExperimentationNo client‑side cloaking: bots must see a stable, indexable version (avoid A/B that changes indexable content for bots only).Keep experiments server‑side (SSR/ISR) or non‑indexable UI variations.For content experiments (titles, descriptions), roll out by entity cohorts; revalidate ISR pages on change.1.17.14 Risk Register & MitigationsDuplicate content via tracking params → mitigated by canonical middleware + 301.Faceted crawl bloat → noindex, follow + allowlist + self‑canonical.Accidental 18+ leakage → centralized SFW image service for OG/JSON‑LD; tests in CI.Thin pages (empty profiles) → hold noindex until profile meets completeness threshold.CLS regressions → enforce width/height on images; block unstyled font flashes.1.17.15 QA Checklists (Pre‑launch & Ongoing)Pre‑launchCanonical/robots tags verified on top templates.Sitemaps (web/image/video) present and validate; robots.txt references index.JSON‑LD validates on 25 sample pages across types.Lighthouse p75 budgets met on emulated mobile.All OG images SFW; email templates tested for SFW previews.OngoingWeekly crawl dashboard reviewed; non‑indexable hit rate trending down.GSC: errors addressed; CTR and position monitored for top city/role pages.Uptime for ISR revalidation hooks; cache hit ratio ≥95% for public pages.1.17.16 Work Packages (Cursor 4‑agent lanes)Agent A — Web: canonical middleware, meta/LD‑JSON injectors, templates (title/desc/headers), image/video sitemaps, breadcrumb component.Agent B — API: SEO resolvers, slug service, ISR revalidation hooks, Search Console export cron.Agent C — Ops: CloudFront behaviors, logs→S3→Athena pipeline, robots/noindex header policy, cache keys.Agent D — QA/Perf: Lighthouse CI, JSON‑LD tests, SFW OG guard, crawl dashboards, a11y audits.1.17.17 Acceptance Criteria (mark §1.17 FINAL only when ALL true)Canonical URLs, robots headers + meta, and parameter stripping are live; filter/pagination pages are noindex and self‑canonical.City/role landings exist and are indexable; hubs and detail pages have SFW OG images; age‑gated items are noindex.JSON‑LD present and valid for Person(+Offers), LocalBusiness, Article, BreadcrumbList, and (where applicable) VideoObject.Segmented web + image + video sitemaps generate correctly and reference only indexable content; robots.txt points to the index.CWV budgets met (p75 mobile) on Home, City/Role landing, Service Profile, Studio Detail, and a Case Study page.A11y checks pass (axe/Pa11y) on public pages; images have alt; keyboard navigation functional.CloudFront logs + GSC are ingested; crawl waste <10% of bot hits after 30 days; cache hit ratio ≥95%.SEO‑safe experimentation policy enforced; no client‑side cloaking or bot‑variant divergence.§1.18 — Security, Compliance & DevSecOps(zero‑trust architecture · IAM boundaries · authN/authZ for AppSync · secrets & key mgmt · encryption in transit/at rest · data classification & PII minimization · logging/audit & tamper‑evidence · WAF/bot/DDOS protections · vulnerability mgmt & CI/CD hardening · incident response & DR · compliance scaffolding · telemetry, SLOs, tests, costs)Purpose. Define the end‑to‑end security & compliance posture for the marketplace (web/app, Amplify/AppSync/Lambda/Aurora/DynamoDB/S3/CF, Stripe/IDV/esign providers), with implementation‑grade controls and inline artifacts you can paste into the plan. This section will not advance until it satisfies the ≥99.9% bar.1.18.A Security canon & threat modelLeast privilege & zero trust. Every call is authenticated and authorized; no “trusted subnet.”Default‑deny at edges. WAF blocks obvious bad traffic; API throttles by identity.PII minimization. Only store what we must; tokenize or hash where possible; keep PII out of logs.Compartmentalization. Separate AWS accounts per env (dev/stage/prod) and per blast radius (prod‑data, prod‑ops).Tamper‑evident audit. Immutable trails for money/IDV/policy actions.Idempotence everywhere. All webhooks & money operations idempotent (no double charges).Cost aware. Prefer managed services (Amplify, Cognito, AppSync, WAF, Security Hub) over self‑hosted appliances.1.18.B Identity & access management (IAM) boundariesRecommended path: security/policies/iam-boundaries.mdAccounts & orgAWS Organizations with SCPs: deny *:* at root, deny public S3 unless explicitly allowed, deny KMS key deletion.Separate accounts: rastup-dev, rastup-stage, rastup-prod, plus rastup-shared (log archive) and rastup-security.RolesWorkload roles: per Lambda/service with minimal permissions (AppSync resolver roles; S3 prefixes; DynamoDB tables).Human roles: AdminLimited (break‑glass), OpsReadOnly, Analyst, SecurityEngineer. MFA enforced; session limits (1–4h).JIT elevation via IAM Identity Center (formerly SSO) with approval; all admin actions audited.Inline artifact — example least‑priv Dynamo policy", "status": "todo", "agent": null, "priority": 116, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.19.4", "root": "WBS-1", "source": "TD", "title": "Locale detection & routing (no auto‑redirect loop)Middleware (concept)", "status": "todo", "agent": null, "priority": 117, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.19.9", "root": "WBS-1", "source": "TD", "title": "Public SEO pages: localized metadata & JSON‑LDHead helper", "status": "todo", "agent": null, "priority": 118, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.19.12", "root": "WBS-1", "source": "TD", "title": "A11y testing (automated + manual)Automated (CI): axe + pa11y on /, /city/{city}, /p/{handle}, /s/{slug}, /checkout.", "status": "todo", "agent": null, "priority": 119, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.19.14", "root": "WBS-1", "source": "TD", "title": "Governance: language coverage & content policyLaunch locales: en-US; “Phase 2”: es-ES; “Phase 3”: fr-FR, de-DE, ar.Gate publishing of a locale until: 100% key coverage, pseudolocalization pass, a11y pass, SEO checks (hreflang).Maintain a glossary per role/feature to keep translations consistent.1.19.15 Work packages (Cursor 4‑agent lanes)Agent A — Web/App: i18n provider, locale switcher, RTL styles, A11y components (Modal, Combobox, SkipLink), head meta helper.Agent B — API/SSR: user prefs fields/resolvers, server formatting helpers, Node full‑icu build, JSON‑LD localization.Agent C — Comms/SEO: localized MJML templates, subject/From localization, hreflang tags, sitemap alternates.Agent D — QA/Tooling: extractor/pseudolocalizer, axe/pa11y CI, screenshot diff, catalogs versioning/CDN invalidation.1.19.16 Acceptance criteria — mark §1.19 FINAL only when ALL trueLocale selection persists; server adds lang & dir correctly; no auto‑redirect loops; hreflang alternates present on SEO pages.ICU MessageFormat is used across web/app/emails; prices/dates/numbers localized; dual‑timezone display where relevant.RTL renders correctly: layout mirrored, icons swapped, reading order valid; no clipped/truncated text.A11y: WCAG 2.2 AA checks pass (axe/pa11y + manual SR runs); keyboard navigation works across all interactive components.Public pages (SEO) pre‑render localized titles/descriptions/JSON‑LD with SFW images only; Safe‑Mode rules respected.Catalogs load per‑locale (no shipping all); bundle budgets met; Node SSR has full‑icu.Translation workflow operational: extraction → PR review → pseudolocalized QA → deploy; glossary maintained.Emails localized, with quiet hours by timezone; no 18+ previews in emails.Costs controlled: catalogs on S3/CDN; no paid localization SaaS at launch.§1.20 — Mobile (PWA + Optional Native Shells), Push, and Device Capabilities(app architecture · PWA config & offline · optional RN/Expo shells · deep links & routing · auth/session on device · push notifications (APNs/FCM/Pinpoint) · file uploads from camera · Safe‑Mode & age‑gated UX · performance budgets · a11y on mobile · CI/CD & releases · telemetry · tests · cost posture)Purpose. Specify the complete mobile experience: a first‑class Progressive Web App (PWA) that covers the entire user journey (discovery → messages → booking → delivery), with an optional React Native (Expo) shell for app store presence when/if desired. This section defines how we implement offline, push, deep‑links, device uploads, Safe‑Mode gating, performance, a11y, telemetry, CI/CD, and costs. All artifacts are inline text for your Word doc with “Recommended filename/path” tags so your builders can later lift them into the repo.1.20.A Canon & invariantsPWA‑first: one codebase (Next.js) with service worker, install prompt, offline for core routes, and background sync for drafts/uploads.Optional native shells (React Native + Expo) wrap the web for store distribution and system‑level push; both shells and PWA use the same AppSync APIs.Safe‑Mode on mobile: defaults ON for guests/new installs; SFW previews only; 18+ features gated behind age verification and explicit user choice, never emailed or pushed with previews.Cost‑conscious: APNs/FCM via Amazon Pinpoint/SNS, no extra third‑party SDK bloat; media uploads are direct‑to‑S3 presigned, resized on device.Accessibility: WCAG mobile patterns, large tap targets, VoiceOver/TalkBack tested, motion‑safe animations.Privacy: no background location; images EXIF stripped on upload (unless user opts in for studio proofs).1.20.B Client architecturePWA shell (Next.js): app‑router, service worker, manifest, edge caching; GraphQL via AppSync (JWT auth).Native shells (optional):React Native + Expo (managed workflow) for iOS/Android.Uses a small native bridge for push tokens, file pickers, camera, and device storage; renders either RN screens or a WebView wrapper for certain flows if we choose a hybrid approach.Shared modules: auth/session, GraphQL client, feature flags, Safe‑Mode, formatting (ICU), and analytics events shared across PWA and RN.1.20.C PWA configuration (manifest, SW, caching, offline)Recommended path: web/public/manifest.webmanifest{", "status": "todo", "agent": null, "priority": 120, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.3", "root": "WBS-1", "source": "TD", "title": "Data model (Aurora) — orders, intents, transfers, refundsRecommended path: db/migrations/022_payments_core.sqlbegin;", "status": "todo", "agent": null, "priority": 121, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.5", "root": "WBS-1", "source": "TD", "title": "Stripe Connect onboarding (providers)Type: Express accounts; Stripe‑hosted onboarding/updates.Enable capabilities for payments/transfers; Stripe handles KYC; we reflect verification status in UI (account.updated webhooks).Payout schedule: weekly by default; consider T+1/T+7 policy gates (see §1.22.11).Artifact — onboarding link resolver", "status": "todo", "agent": null, "priority": 122, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.6", "root": "WBS-1", "source": "TD", "title": "Charges & transfers patternChoose one per order for simplicity:Destination chargeCharge on connected account; include application_fee_amount.Pros: Simple split; Stripe handles fee. Cons: Fewer methods; less transfer timing control.Separate charges & transfers (recommended)Charge on platform; attach transfer_group=order_id; create Transfer to provider on completion.Pros: Full payout timing control; clean refunds. Cons: Platform temporarily carries liability.1.22.7 Webhooks, idempotency & order state machineListen to:", "status": "todo", "agent": null, "priority": 123, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.9", "root": "WBS-1", "source": "TD", "title": "Credits, vouchers & taxesCredits (referral/promos) reduce platform fee (buyer_fee) only unless promo explicitly subsidizes subtotal.If a promo reduces subtotal, it’s platform‑funded; treat as negative revenue in analytics.Tax on platform fees depends on jurisdiction; at launch either (a) enable Stripe Tax for the fee component, or (b) restrict to jurisdictions where fees are non‑taxable. Provider service tax remains provider’s responsibility at launch; we show guidance.Artifact — platform invoice MJML (fee line item)", "status": "todo", "agent": null, "priority": 124, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.11", "root": "WBS-1", "source": "TD", "title": "Fraud controls & risk flags (tied to §1.18 / §1.15)Signals: rapid multi‑card attempts, device fingerprint mismatch, same IP across multiple buyers, new provider with unusually high prices, excessive outbound messages/spam.Actions: enforce 3DS on high‑risk cards, manual review holds, increase reserve, delay transfer until IDV passes.Every decision is written to the immutable audit trail (see §1.18.H).1.22.12 Reconciliation — ledgers & analytics lakeBronze: raw webhook dumps + Stripe balance transactions → S3.", "status": "todo", "agent": null, "priority": 125, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.14", "root": "WBS-1", "source": "TD", "title": "Telemetry, SLOs & costEvents: checkout.start|confirm|success|fail, refund.create, dispute.open|won|lost, transfer.create|paid, payout.paid|failed.KPIs: checkout conversion, authorization/capture rates, refund %, dispute %, T+N transfer SLA, webhook latency.SLOs: payment success p50 ≥ 96% (cards); webhook processing p95 ≤ 2s; transfer execution after completion p95 ≤ 15m; D+1 reconciliation completeness by 08:00 UTC.Cost posture: Stripe only at launch; ACH only when volume justifies; no third‑party fraud SaaS initially—rely on Stripe Radar + our risk flags; serverless webhooks & nightly reconciliation to keep compute low.1.22.15 Test planCard happy path (with/without credits), receipts.Manual capture (authorize, capture/void) path.Refunds (full/partial) per policy; credits re‑application logic.Disputes lifecycle (open → evidence → closed win/loss) and payout clawback/release.ACH flow (when enabled): settlement timing; transfer after funds clear.Webhooks idempotency: replay same event.id → no duplicate effects.Reconciliation: balance transactions vs ledgers; variance ≤ $0.01 per order.Risk: forced 3DS; rate‑limit card attempts; apply reserve.1.22.16 Work packages (Cursor 4‑agent lanes)Agent A — Buyer Checkout & Credits: PI creation/confirm, credits application, receipts, error handling.Agent B — Provider Onboarding & Payouts: Connect Express flow, payout schedule/reserves, transfer logic, statements.Agent C — Webhooks & Reconciliation: webhook lambdas + idempotency, ledgers, daily Stripe exports, Silver model & dashboards.Agent D — Admin & Risk: finance console, refunds/holds/releases, dispute evidence packs, risk flagging & decisions.1.22.17 Acceptance criteria — mark §1.22 FINAL only when ALL trueCheckout supports cards (Apple/Google Pay where available); credits apply to buyer_fee only; orders reach captured.Provider onboarding via Connect Express; payouts scheduled per policy; reserves supported.Webhooks idempotent; state machine transitions correct; clawbacks/holds work.Refunds/disputes complete end‑to‑end with accurate ledger entries and communications.Separate charges & transfers implemented with controllable transfer timing; reconciliation (Silver) runs without variances.Admin console (role‑gated) supports refund/hold/release & evidence; all actions audited.KPIs/SLOs measured with alerts; D+1 reconciliation completes by 08:00 UTC.Costs within launch budgets; ACH deferred until justified.§1.23 — Messaging, Inbox & Collaboration (Technical Spec)Scope: This section implements the non‑technical “SubSection 1.4 — Messaging, Inbox & Collaboration UX” in full technical detail (objects, flows, folders, filters, credits, action cards, safety controls). The non‑technical goals include role‑aware & booking‑aware threads, a single source of truth for chat + project context, respectful fast communication (receipts, templates), and strong safety/anti‑circumvention tooling, including report/block and rate limits. NonTechBlueprintIn addition, Trust & Safety requires Safe‑Mode behavior on previews, reporting flows, escalation, and harassment/doXXing protections that also apply inside messaging. NonTechBlueprint_Part31.23.1 Canon & InvariantsRole‑aware, Booking‑aware: Every thread is anchored to a Role Context (service profile) and, when applicable, a Booking. This mirrors the non‑tech “Roleaware & Bookingaware” principle. NonTechBlueprintSingle source of truth: Messages + structured Project Panel context (package, schedule, call sheet, contracts, deliverables, extras, payments) co‑exist in the thread. NonTechBlueprintStructured “Action Cards”: time proposals/reschedules, add‑ons, overtime, proofs/finals, approvals, expense receipts, mark‑completed, open dispute, share location, safety flag—sent as typed, machine‑readable cards. NonTechBlueprintMessage Requests & Credits: First‑time contacts land in Requests; users can Accept/Decline/Block. New conversation credits throttle cold outreach; replies and booking‑thread messaging remain unlimited. Contact filters (ID‑verified only, budget disclosed, date provided) are enforced before a message can be sent. NonTechBlueprintSafety & Policy: Prominent Report/Block, rate limits, spam detection, and PII redaction tools for support are required. Messaging must respect Safe‑Mode on previews and use the policy escalation flows. NonTechBlueprint_Part3Privacy: No sensitive EXIF by default on uploads; redactable message copies for legal/dispute workflows.Cost posture: Serverless realtime (AppSync + DynamoDB + S3 + Lambda) with pay‑per‑use; Typesense (shared) for message search snippets.1.23.2 Data ModelWe follow the non‑tech “Objects (data model at a glance)”—Thread, Message, Attachment, and Project—while adding normalized/denormalized details to meet performance and safety requirements. NonTechBlueprint1.23.2.1 DynamoDB (primary, realtime path)Table: msg_threads (PK = threadId, SK = constant)", "status": "todo", "agent": null, "priority": 126, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.26.7", "root": "WBS-1", "source": "TD", "title": "JIT access & privacy guardrailsCase‑bound scopes: to open any message or attachment, an admin must attach it to an open case; access grants are time‑boxed (e.g., 2 hours) and auto‑revoked when case status changes.View/download of sensitive artifacts (IDs, invoices, door codes) uses signed, single‑use URLs with short TTL.All views generate admin_audit entries with IP/UA and the case id.1.26.8 Observability & SLAsEvent taxonomy: admin.login, admin.case.create|act|close, admin.user.suspend|reinstate, admin.refund|hold|release, admin.template.publish, admin.search.pin, admin.synonym.upsert, admin.flag.set, admin.audit.view.Dashboards: case backlog & aging, time‑to‑first‑response, time‑to‑resolution, dispute outcomes, refund rate, appeal win rate, moderator workload, finance queue length, search pin performance.SLOs:Reports triaged p95 ≤ 4h (business hours)Disputes resolved p95 ≤ 5 daysFinance webhook→action p95 ≤ 15mAudit write availability 99.99%1.26.9 Content & SEO operations (light CMS)Admin UI to author help articles (Markdown→HTML), announcements, and city snippets (meta description/intro copy).All content is versioned, localized (ties to §1.19), and pre‑rendered for SEO; Safe‑Mode always respected on public surfaces.1.26.10 Rate‑limit & risk tuningSliders/toggles for message starts/hour, signup/IP/day, search API burst, payments 3DS threshold.Changes require two‑person approval (4‑eyes) for high‑impact risk knobs; change‑log recorded in audit.1.26.11 Feature flags & configFlags: Instant Book eligibility, response SLA, deposit capture policy, city activation, Studio Lite requirement for IB, Saved‑search digests cadence.Backed by DynamoDB table with typed schema, exposed read‑only to clients via CDN JSON for fast boot (signed, cache‑controlled).1.26.12 CI/CD & access controlsAdmin app deploys to a separate Amplify environment / CloudFront distribution.SSO required for any access; WAF blocks public traffic; IP allowlist; rate‑limits.Secrets in AWS Secrets Manager; no admin credentials in code.1.26.13 Test planRBAC: each role’s allowed/denied actions enforced; step‑up auth for finance/disputes.Cases: create/triage/resolve; SLA timers and notifications.User: suspend/reinstate; DSAR export; deletion request workflow.Listings: publish/unpublish; hazard/surveillance flags; COI required.Finance: refund/hold/release; reconciliation viewer; audit entries present.Search curation: pins & synonyms appear in search; TTL expiry works.Docs admin: template publish; envelope monitor; evidence view.CMS: help/announcement create & publish; localization; SEO pre‑render.JIT access: cannot open messages without case; time‑boxed access revokes properly.Audit: 100% of admin actions write to admin_audit and S3 WORM stream.1.26.14 Work packages (Cursor 4‑agent lanes)Agent A — RBAC, Cases & Audit: schema, resolvers, case flows, immutable audit, JIT access.Agent B — Ops UIs: user/listing management, T&S workbench, finance console, curation tools, CMS screens.Agent C — Flags & Risk: feature flags backend, risk knobs, rate‑limits, city activation controls.Agent D — Observability & SSO: SSO/OIDC integration, step‑up auth, dashboards, alerts, WAF/IP allowlist.1.26.15 Acceptance criteria — mark §1.26 FINAL only when ALL trueRBAC & SSO enforced; destructive actions require step‑up; least privilege verified.Cases (reports/DMCA/disputes/fraud) run end‑to‑end with SLA timers, evidence capture, and outcome recording.Finance console performs refunds, holds, releases; reconciliation viewers work; audit exists.Listing and user moderation tools operate with privacy safeguards; messaging access is case‑bound and time‑boxed.Search curation and Smart Docs admin functions are live; CMS can publish localized help/announcements/city snippets.Feature flags & risk knobs adjustable with audit trails and (for high‑impact) 4‑eyes approval.Observability dashboards and SLO alerts are active; audit stream is immutable (S3 Object Lock).Costs and security controls match launch posture (serverless, CloudFront+WAF, IP allowlist).§1.27 — SEO & On‑Site Optimization — Full Technical Spec(crawl control · SSR/ISR build strategy · canonical/robots/sitemaps · structured data · pagination & faceted navigation · Safe‑Mode & SFW indexing · media/OG tags · Core Web Vitals budgets · internal linking · error/redirect policy · analytics & monitoring · tests · acceptance)Purpose. Implement an SEO system that safely exposes only SFW content, scales city/role/studio listings without creating crawl traps, and drives qualified discovery for People and Studios. This fills the non‑technical gap you flagged and ties into earlier sections (Search §1.21, Studios §1.24, Messaging §1.23, Payments §1.22, Admin §1.26).1.27.1 Canon & invariantsSFW‑only indexing. Public pages (profiles, studios, city pages) must render SFW previews and noindex any page that would expose 18+ content or paid assets. Safe‑Mode OFF areas are never indexed.Stable URLs & canonical rules. We allow a small, controlled set of query params to be indexed; everything else is canonicalized to a base URL to avoid duplicate content and crawl traps.SSR/ISR. City & directory pages use Next.js SSR + Incremental Static Regeneration (ISR) for speed and freshness; profiles/studios use SSR with short revalidation.Lightweight structured data. We publish JSON‑LD for Person (People profiles), Place (Studios), and BreadcrumbList on directories; never include exact addresses on public Studio pages (privacy).Crawl budget control. We pre‑render and surface only “thin‑spine” pages (Cities × Roles/Genres), not combinatorial facets.Performance first. Core Web Vitals (CWV) budgets are enforced at build and runtime (LCP, INP, CLS).1.27.2 URL design & routingPages (examples):City directory: /tx/houston/models (/state/city/role)Genre slice: /tx/houston/models/editorialStudio directory: /tx/houston/studiosProfile: /p/{handle} (SFW profile)Studio: /s/{slug} (SFW listing; exact address hidden)Content hubs / guides (optional): /guides/houston-photography-studiosCanonical param whitelist: ?page=, ?sort= limited to best|new|price_low|price_high|distance when an origin exists. All other params are dropped in canonicals. Deep facet queries (ANY/ALL filters) do not get indexable canonicals.1.27.3 Canonical, robots, and meta tagsRecommended path: web/lib/seo/canonical.tsexport function canonicalFor(url: URL) {", "status": "todo", "agent": null, "priority": 127, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.27.4", "root": "WBS-1", "source": "TD", "title": "robots.txt and crawl allowancesRecommended path: web/public/robots.txtUser-agent: *", "status": "todo", "agent": null, "priority": 128, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.27.6", "root": "WBS-1", "source": "TD", "title": "Structured data (JSON‑LD)A) Person (SFW profile)Recommended path: web/seo/jsonld-person.tsxexport function PersonJsonLd({ p }) {", "status": "todo", "agent": null, "priority": 129, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.27.12", "root": "WBS-1", "source": "TD", "title": "Error & redirect policy4xx: custom 404 with search module; return 404 (not soft).5xx: friendly error page; Retry-After when under maintenance.Redirects:Legacy slugs preserved via 301; maintain a slug_redirects table (source → target).Force canonical host (www vs apex) and HTTPS.Trailing slashes normalized.Recommended path: web/next.config.mjs (excerpt)async redirects() { return [", "status": "todo", "agent": null, "priority": 130, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.27.13", "root": "WBS-1", "source": "TD", "title": "Safe‑Mode & SFW gating (SEO)Indexable pages must be Safe‑Mode clean: if any visible component would render NSFW previews, return noindex,nofollow.Profile/studio completeness: below threshold → noindex to avoid thin content.Fan‑Sub (paid): noindex on all paid content and collection pages; preview pages (teasers) are SFW.1.27.14 Analytics & monitoringGSC integration per environment (prod only).Event taxonomy: seo.published, seo.noindex_applied, seo.sitemap.emit, seo.redirect.hit, seo.ogimage.render.Dashboards: impressions/clicks by city/role, CTR by directory, profile/studio coverage (% indexable), sitemap submission health, crawl errors over time.Alarms: surge in 5xx, sitemap job failures, spike in noindex_applied beyond baseline (could indicate Safe‑Mode flagging).1.27.15 Cost postureServerless build & serve: ISR caches on CloudFront; minimal SSR compute.OG image render: edge function cached with low TTL; invalidate only on profile/studio image change.No third‑party SEO SaaS required at launch; GSC + internal logs suffice.1.27.16 Artifacts (copy‑pasteable)web/public/robots.txt (above)web/pages/sitemap.xml.ts (index builder) + web/pages/sitemaps/*.ts (modular feeds)web/lib/seo/canonical.ts (canonical builder)web/seo/jsonld-person.tsx, web/seo/jsonld-place.tsx, web/seo/jsonld-breadcrumbs.tsxweb/app/(public)/.../opengraph-image.tsx (dynamic OG images)observability/budgets/web.json (CWV budgets)web/next.config.mjs redirects (legacy → canonical)1.27.17 Test planIndexability matrix: verify index,follow on city listings, SFW profiles/studios; verify noindex,nofollow on any page with NSFW risks, Safe‑Mode OFF, or paid content.Canonicals: for facet URLs, canonical points to base; for allowed sorts/pagination, canonical preserves them; prev/next present for paginated listings.Sitemaps: validate XML; GSC fetch succeeds; sitemaps list only indexable URLs; updated on publish/unpublish.JSON‑LD: Person/Place/Breadcrumb validate in Rich Results; studios never leak exact address pre‑booking.OG/Twitter: correct images and titles; images update on asset change; cached at edge.CWV: Lighthouse CI passes budgets on templates; field beacons report within targets after deploy.Redirects: legacy slugs 301 to current; no redirect loops; canonical host enforced.Error handling: 404 returns hard 404; maintenance returns Retry‑After; robots obeys disallows.Security: no PII or paid asset URLs in page source; signed URLs never appear in HTML.1.27.18 Acceptance criteria — mark §1.27 FINAL only when ALL trueRobots, canonicals, and sitemaps are live; only SFW, complete pages are indexable; combinatorial facets are non‑indexable.Profiles (Person) and Studios (Place) emit valid JSON‑LD; city/role directories emit BreadcrumbList; no exact studio address is exposed.SSR/ISR strategy implemented; paginated HTML for bots; prev/next and canonical tags correct.OG/Twitter images render with correct caching; redirect rules cover legacy paths.Core Web Vitals budgets enforced (build & field); dashboards and alerts wired; GSC is clean of soft‑404 or duplicate‑content warnings.Costs remain within launch budgets; no third‑party SEO tool lock‑ins.§1.28 — Admin Console, Ops & Support (Back‑Office) — Full Technical Spec(RBAC & SSO · immutable audit/WORM · user/listing moderation · Trust & Safety casework (reports, DMCA, disputes) · finance ops & reconciliation · search curation tools · Smart Docs admin · CMS (help/announcements) · feature flags & risk knobs · observability & SLAs · tests · acceptance)Purpose. Provide safe, efficient operational tooling to run the marketplace—moderate users/listings, handle reports/DMCA/disputes, operate refunds/payouts, curate search, manage Smart Docs templates, publish help/announcements, tune risk/rate‑limits, and observe SLOs—while enforcing least‑privilege, case‑bound access, and immutable audit.1.28.1 Canon & invariantsLeast privilege + JIT access. Roles narrowly scoped; message/media viewing requires case‑bound time‑boxed access.Immutable audit. Every admin action is recorded in Aurora and appended to S3 with Object Lock (WORM).Separation of duties. Finance vs Trust & Safety (T&S) vs Support vs Content Ops vs Search Curation vs Docs Admin.Privacy by design. Sensitive artifacts only via short‑TTL, single‑use signed URLs; all access audited.Cost posture. One Next.js Admin app behind CloudFront + WAF + IP allowlist; serverless APIs (AppSync/Lambda/Data API).1.28.2 Roles & permissions (RBAC)Initial rolessuper_admin (break‑glass, time‑boxed)trust_safety (reports, DMCA, disputes, suspensions)finance_ops (refunds, payout hold/release, reconciliation views)support (account lookup, resend emails, reset MFA, grant limited credits)content_ops (help/announcements/city SEO snippets)search_curator (pins, synonyms)docs_admin (template/versioning & envelope monitor)engineering (feature flags, config, observability read)Recommended path: admin/rbac/policy.json{", "status": "todo", "agent": null, "priority": 131, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.28.7", "root": "WBS-1", "source": "TD", "title": "JIT access & privacy guardrailsCase‑bound scopes grant temporary read (and limited reply where policy allows) to specific threads/media.Sensitive artifacts (IDs, invoices, door codes) are served only by short‑TTL, single‑use signed URLs; downloads counted and audited.All access writes an admin_audit record with case id, IP, UA, and reason.1.28.8 Observability & SLAsEvents: admin.login, admin.case.create|act|close, admin.user.suspend|reinstate, admin.refund|hold|release, admin.search.pin, admin.synonym.upsert, admin.template.publish, admin.flag.set, admin.audit.view.Dashboards: case backlog/aging, time‑to‑first‑response, time‑to‑resolution, dispute outcomes, refund rate, moderator workload, finance queue length, pin performance.SLOs:Report triage p95 ≤ 4h (business hours)Dispute resolution p95 ≤ 5 daysFinance webhook→action p95 ≤ 15mAudit write availability 99.99%1.28.9 CMS & SEO ops (public content)Markdown editor with preview; scheduled publish/unpublish; locale keys; image handling (alt text required); SEO pre‑render.Safe‑Mode enforced on public surfaces; no NSFW in help/announcements.1.28.10 Rate‑limit & risk tuningToken buckets for message starts/hour, signup/IP/day; 3DS enforcement threshold sliders.High‑impact changes require two‑person approval; changes are audited with before/after values.1.28.11 Feature flags & configurationFlags stored in DynamoDB with typed schema; read‑only, signed JSON snapshot exposed via CDN to clients for fast boot.Secrets stored in AWS Secrets Manager; no keys in code.1.28.12 CI/CD & access controlsAdmin app deployed to a dedicated Amplify/CloudFront stack; WAF and IP allowlist required.SSO enforced for all routes; break‑glass elevation requires ticket id; logs routed to centralized logging with retention.1.28.13 Test planRBAC matrix enforced; step‑up auth for finance/disputes.Cases: create/triage/resolve; SLA timers and notifications; evidence upload/review.User moderation: suspend/reinstate; DSAR export/deletion flow with legal hold exceptions.Listing moderation: publish/unpublish; hazard & surveillance flags; COI required.Finance ops: refund/hold/release; reconciliation viewer; audit entries present.Search curation: pins/synonyms propagate; TTL expiry works; zero‑results insights populated.Docs admin: template publish; envelope status monitor; resend/void; expiry knobs apply.CMS: help/announcement creation; localization; SEO pre‑render.JIT access: cannot open messages without an open case; grants auto‑expire.Audit/WORM: 100% of actions mirrored to S3 Object Lock; tamper attempts rejected.1.28.14 Work packages (Cursor 4‑agent lanes)Agent A — RBAC, Cases & Audit: schema, resolvers, case queues, immutable audit, JIT access.Agent B — Ops UIs: user/listing mgmt, T&S workbench, finance console, curation tools, CMS.Agent C — Flags & Risk: flag backend, risk knobs, 4‑eyes workflow, city activation controls.Agent D — SSO/Observability: OIDC groups/roles, WebAuthn step‑up, dashboards, alerts, WAF/IP allowlist.1.28.15 Acceptance criteria — mark §1.28 FINAL only when ALL trueRBAC & SSO enforced; destructive/financial actions require step‑up; least‑privilege verified.Casework (reports/DMCA/disputes/fraud) runs end‑to‑end with SLA timers, evidence capture, and outcomes recorded.Finance console performs refunds, payout holds/releases; reconciliation viewers operate; all actions audited.Listing & user moderation tools function with privacy safeguards; message/media access is case‑bound and time‑boxed.Search curation and Smart Docs admin are operational; CMS publishes localized help/announcements/city snippets.Feature flags & risk knobs adjustable with 4‑eyes approval; complete audit trail.Observability dashboards live; SLO alerts wired; audit stream is immutable (S3 Object Lock).Costs/security match launch posture (serverless, CloudFront+WAF, IP allowlist).§1.29 — Case Studies, Portfolios & Boards — Full Technical SpecPurpose. Showcase real work (case studies, portfolio sets) on role profiles to increase buyer trust and conversion; allow collaborators to be tagged and approve credits; let buyers and producers collect favorites on Boards and launch “Request a similar shoot” flows. All public surfaces must remain SFW with Safe‑Mode gating, collaborator approvals, and DMCA/abuse handling. This section implements the non‑technical acceptance: portfolio tab on profiles; tagging & approvals; collaborator links to profiles; “Add to Board”; Safe‑Mode/SFW only; and editor tools in the owner dashboard. NonTechBlueprint1.29.1 Scope (from non‑technical plan → technical)Portfolio tab on public role profiles with SFW media, grids/galleries, and case‑study stories. Owner dashboard includes a Portfolio editor. NonTechBlueprintTag collaborators on portfolio items; collaborators must approve or decline the credit before their avatar/name appears; collaborator chips open profiles. NonTechBlueprintBoards (collections) across People, Studios, and Portfolio items; Add to Board from any eligible card; event telemetry board.add. NonTechBlueprintStudio linking: portfolio items can show the studio used and link to that studio page; role profiles can show “Has/Owns Studio” chips; telemetry studio.link.click. NonTechBlueprintSafe‑Mode: public surfaces remain SFW; anything beyond permitted tiers is hidden or “blurred with label” per policy when Safe‑Mode is ON. NonTechBlueprint1.29.2 Architecture (cost‑conscious, elastic)Frontend: Next.js (web) SSR for profile tabs; React Native (mobile) with identical data shape.API: AppSync GraphQL with Lambda resolvers.Storage: S3 (versioned) for images/video; CloudFront delivery; optional on‑upload transforms (thumbs, web‑optimized).Search/Discovery: Typesense collections for light faceting (“genres”, “city”, “role”), plus profile ranking signals.Moderation & policy: Safe‑Mode renderer + optional Rekognition moderation check; DMCA/T&S flows via Admin (§1.28).Cost posture: No external DAM/SaaS. S3 lifecycle → IA/Glacier; CloudFront caching; transforms cached.1.29.3 Data model (Aurora PostgreSQL + S3)Tables (schema portfolio)portfolio_itemitem_id pk, owner_user_id, role_profile_id, title, slug, city, shoot_date, genres text[],", "status": "todo", "agent": null, "priority": 132, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.29.5", "root": "WBS-1", "source": "TD", "title": "Public UI (web) & owner/editor flowsProfile → Portfolio tab (public):Grid (masonry) of Portfolio Items; hover shows title, city, genres; Safe‑Mode ensures SFW only on public surfaces. NonTechBlueprintCase‑study page (optional route /p/{handle}/work/{slug}) with hero media, story, deliverables, “Request a similar shoot” CTA, collaborators row (only approved chips click to profiles), and “Studio used” chip linking to the studio page. NonTechBlueprintOwner editor (dashboard):Sections: Portfolio (media upload, order, cover pick), Case Study (story/results/deliverables), Collaborators (invite → pending → approve/decline UI), Studio used (search/link). These tools are called out in the non‑technical owner editor scope. NonTechBlueprintBoards (public/private):From any People/Studio/Portfolio card: Add to Board → picker (create new or choose existing); fires board.add telemetry. NonTechBlueprintBoard page lists items (mixed types) with notes; can be private (default), unlisted (share link), or public (SEO‑light; SFW only).“Request a similar shoot”On case‑study pages and Board pages, a CTA opens a pre‑filled RFP (city, genres, budget band from case study). On submit, it creates an inquiry thread to the owner (or a marketplace RFP if configured).1.29.6 Safe‑Mode & policySFW enforcement on all public portfolio/board surfaces; beyond permitted tiers are not rendered (or shown as blurred blocks with “Hidden in Safe‑Mode” label) and pages remain indexable only when SFW. NonTechBlueprintCollaborator consent: only approved tags render; pending/declined never show publicly. NonTechBlueprintDMCA/T&S: one‑click report from item menu routes to Admin casework (§1.28) for takedown review; item can be blocked system‑wide during review.Watermarks (optional): on public previews only; originals retained in S3 and not publicly accessible.1.29.7 Media pipelineUpload via presigned S3; client sends x-amz-meta-sfw-band.Lambda transform: generate web‑optimized images (e.g., 1920/1280/640 px) + poster for video; strip EXIF; enforce max duration/size.Moderation check (optional): Rekognition Moderation; if score > threshold, set status='pending' and send to T&S queue.Caching: CloudFront with aggressive caching; image URLs include content hash to bust on update.1.29.8 Discovery & SEOJSON‑LD: CreativeWork (case study pages) or ImageGallery (portfolio grids) for SFW‑only items; profile/studio JSON‑LD stays as Person/Place (§1.27/§1.24).Internal linking: collaborator chips → profiles; studio chip → studio page; related items carousel on case‑study pages.Sitemaps: include only SFW case‑study routes; omit private/unlisted boards.Telemetry: board.add, portfolio.tag.approve, portfolio.tag.decline, studio.link.click, profile.view, cta.click.book/message. NonTechBlueprint1.29.9 Analytics & KPIsPortfolio coverage (% of active profiles with ≥3 items), collab approval rate, case‑study view → message/book CTR, boards created per visitor, RFPs initiated from case studies, studio‑from‑portfolio clicks.Event names follow the non‑technical telemetry list (see above). NonTechBlueprint1.29.10 Cost & scaleS3 + CloudFront only (no DAM SaaS). Lifecycle: originals to IA after 30 days; web renditions after 90 days.Rekognition moderation optional toggle by environment.Typesense fields: title, city, genres, role, recency; small documents (no full captions indexing at launch).1.29.11 Artifacts (copy‑pasteable into your Word plan)db/migrations/029_portfolio.sql — tables above.api/schema/portfolio.graphql — schema above.web/seo/jsonld-creativework.tsx — JSON‑LD helper.web/components/PortfolioItemCard.tsx — SFW card UI (title, city, genres, Safe‑Mode label).web/components/AddToBoardDialog.tsx — create/select + add.web/app/(public)/p/[handle]/work/[slug]/page.tsx — case‑study route.lambdas/portfolio-transform/index.ts — image/video transforms + EXIF strip.(All artifacts are text here for your single project doc.)1.29.12 Test planOwner editor: upload, reorder, set cover, write case‑study, publish → renders on profile.Collaborator tags: request → collaborator approves/declines → public chips render only on approve; decline hides. NonTechBlueprintSafe‑Mode: with Safe‑Mode ON, any beyond‑allowed tier media is hidden/blurred; public page remains SFW. NonTechBlueprintBoards: add/remove/reorder across mixed entities; private vs unlisted vs public behaviors; telemetry board.add fires. NonTechBlueprintStudio chip: link on case study opens the studio page; telemetry studio.link.click fires. NonTechBlueprintRequest similar shoot: CTA pre‑fills RFP and creates thread/RFP; edge cases (missing city/budget).DMCA: report → Admin case created → item blocked → unblock on resolution.SEO: JSON‑LD validates; only SFW case‑study URLs appear in sitemaps.Perf: LCP/INP within budgets on portfolio and case‑study templates (ties to §1.27 CWV budgets).1.29.13 Work packages (Cursor 4‑agent lanes)Agent A — Data & API: migrations, GraphQL, presigned upload, moderation hooks, DMCA endpoint.Agent B — Web/RN UI: Portfolio grid, case‑study page, collaborator dialog, Safe‑Mode rendering, Add‑to‑Board dialog.Agent C — Media pipeline & SEO: Lambda transforms, EXIF strip, JSON‑LD helpers, sitemap emitters.Agent D — Discovery & RFP: studio chip linking, “Request similar shoot” pre‑fill flow, Typesense indexing, telemetry.1.29.14 Acceptance criteria — mark §1.29 FINAL only when ALL truePortfolio tab is live with SFW grids; owner can create/edit/publish items and case studies. NonTechBlueprintCollaborator tagging works with approval/decline; only approved credits render; collaborator chips open profiles. NonTechBlueprintBoards can collect People/Studios/Portfolio items; Add to Board is available and tracked. NonTechBlueprintCase‑study pages support Request similar shoot pre‑fill; studio chip links to the studio page. NonTechBlueprintSafe‑Mode strictly enforces SFW on public surfaces; anything beyond allowed tiers is hidden/blurred; pages remain indexable only when SFW. NonTechBlueprintDMCA/report routes to Admin casework; items can be blocked/unblocked via T&S.Telemetry events exist per plan (board.add, portfolio.tag.approve/decline, studio.link.click, etc.). NonTechBlueprintPerformance/SEO budgets pass; cost posture (S3/CloudFront/lifecycle) configured.§1.3 — Booking, Payments & Disputes — Full Technical SpecPurpose. Implement fast, trustworthy booking with Instant Book (IB) and Request‑to‑Book (RTB), private Smart Invite to multiple profiles, escrowed payments, transparent cancellation, and a fair, auditable dispute process. This section translates your non‑technical scope (Service Profile, Packages, Extras, Usage License, IB/Smart Invite, checkout contracts, escrow, payout timing, and disputes) into build‑ready detail. NonTechBlueprint1.3.1 Scope confirmation (from non‑technical → technical)Key concepts & objects: Service Profile (SP), Packages, Extras, Usage License, Instant Book, Smart Invite, Auto‑accept rules. NonTechBlueprintBooking modes: Instant Book; Request‑to‑Book (+ Accept / Decline / Counter); Smart Invite (multi‑recipient private brief; buyer can award one or more hires). NonTechBlueprintCheckout & payment flow: select package/extras/license; pick date/time & location; dynamic travel fees; contract pack auto‑attached (Booking Agreement, Usage License, Model Release for model hires, Content Promotion Terms for creators); e‑sign at checkout; escrow notice; pay & confirm; calendars block; chat opens. NonTechBlueprintEscrow & payout: charge buyer → hold funds (“escrow”) → completion signals (time‑based vs deliverable‑based) → grace/review window → auto‑release if no dispute; new‑provider risk delays first payouts; ACH & card support; tipping after completion. NonTechBlueprint1.3.2 Architecture & cost postureFrontend: Next.js web (SSR for booking; ISR for directory), React Native apps.API: AppSync GraphQL → Lambda resolvers → Aurora Postgres (core booking) + DynamoDB (idempotent event log) + S3 (contracts/attachments).Payments: Stripe Connect (Standard/Express) + PaymentIntents for cards and Financial Connections (ACH). Funds are captured immediately to platform balance and transferred to providers on completion (acts as “escrow” without relying on card auth holds that expire). No extra PSP at launch to control cost and complexity.Compliance: Stripe KYC/KYB for providers, 3DS when required, PCI burden offloaded to Stripe.Cost: Pure serverless, small Aurora Serverless v2 floor, aggressive CloudFront caching, no paid DAM or workflow SaaS.1.3.3 Data model (Aurora, schema booking)Recommended path: db/migrations/013_booking_core.sqlbegin;", "status": "todo", "agent": null, "priority": 133, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.3.5", "root": "WBS-1", "source": "TD", "title": "Booking modes & flowsA) Instant Book (IB) (opt‑in per provider)IB badge in search when allow_ib rule is active; buyer selects date/time, package, extras, license, location; payment → confirmed immediately if within rules; calendars block; chat opens. NonTechBlueprintServer logic: evaluate autoaccept_rule (weekday mask, min price, distance) before confirming; else fallback to RTB. NonTechBlueprintB) Request‑to‑Book (RTB)Buyer configures the same elements and sends a request. Provider can Accept / Decline / Counter (custom offer). On Accept, we charge (if not already) and mark confirmed. Unanswered requests auto‑expire (e.g., 24–48h). NonTechBlueprintC) Smart Invite (private, multi‑recipient)Buyer selects up to N profiles, writes one brief, and sends private invites. Buyer can award one or multiple hires. No public job board. NonTechBlueprint1.3.6 Checkout, contracts & e‑signContract pack auto‑attached at checkout:Booking Agreement (scope, deliverables, schedule, payment terms, cancellation, safety rules)Usage License (commercial/ads/exclusive/buyout tiers with price adders)Model Release (if booking a model)Content Promotion Terms (for creators’ posting timelines/crediting)", "status": "todo", "agent": null, "priority": 134, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.3.5", "root": "WBS-1", "source": "TD", "title": "Booking modes & flowsA) Instant Book (IB) (opt‑in per provider)IB badge in search when allow_ib rule is active; buyer selects date/time, package, extras, license, location; payment → confirmed immediately if within rules; calendars block; chat opens. NonTechBlueprintServer logic: evaluate autoaccept_rule (weekday mask, min price, distance) before confirming; else fallback to RTB. NonTechBlueprintB) Request‑to‑Book (RTB)Buyer configures the same elements and sends a request. Provider can Accept / Decline / Counter (custom offer). On Accept, we charge (if not already) and mark confirmed. Unanswered requests auto‑expire (e.g., 24–48h). NonTechBlueprintC) Smart Invite (private, multi‑recipient)Buyer selects up to N profiles, writes one brief, and sends private invites. Buyer can award one or multiple hires. No public job board. NonTechBlueprint1.3.6 Checkout, contracts & e‑signContract pack auto‑attached at checkout:Booking Agreement (scope, deliverables, schedule, payment terms, cancellation, safety rules)Usage License (commercial/ads/exclusive/buyout tiers with price adders)Model Release (if booking a model)Content Promotion Terms (for creators’ posting timelines/crediting)", "status": "todo", "agent": null, "priority": 135, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.8.7", "root": "WBS-1", "source": "TD", "title": "Quiet Hours & critical exceptionsUser‑set window (e.g., 22:00–07:00 local). During quiet hours, optional notifications queue for digest or delay until window end.Always allow (unless user explicitly disables exceptions):booking.reminder_24h|1hreschedule_expiring_6h (Action Card pending close)payment.failed, payout.failedsafety.case.openedICS attachments: Reminders include .ics files; these still send during quiet hours (critical timeline).1.8.8 Digests (daily/weekly)Builder job (Lambda scheduled) aggregates: new message requests, pending approvals (Action Cards), upcoming bookings with ICS links, recent files.De‑dup if a transactional mail already went out in the last N hours.Timezone‑aware windows per user; fallback to region default if tz missing.1.8.9 Deliverability & suppressionDomain setup: SPF, DKIM, DMARC (p=quarantine → p=reject after warmup), brand alignment (same envelope/from).Warmup: ramp volume over 2–3 weeks; preferentially send booking/receipt (high‑engagement) first.Feedback loops: SES webhooks write notify_consent(action='hard_bounce'|'complaint'); automatically suppress further sends; display banner in app to re‑confirm email.Link tracking: restricted to analytics on transactional messages without altering core links that might trigger spam filters; never track in safety/IDV/legal mail.1.8.10 Security, privacy & complianceConsent ledger for every opt‑in/out/unsubscribe; immutable, time‑stamped with IP/UA.CAN‑SPAM & regional rules: required footer, company address, one‑click unsubscribe for marketing (kept off at MVP).Age gates: never send NSFW references in email/push; FanSub content never previewed in notifications.PII minimization: no door codes/phone numbers in templates; deep links to in‑app views.1.8.11 Rate limits & cost controlsPer‑user/channel token buckets (Dynamo) for optional notifications; transactional are exempt but still idempotent.SES: single region pool, monitor spend; fall back to low‑volume provider (Resend/Mailgun) via adapter if SES rate‑limited.Pinpoint: only register active device tokens; expire tokens after 90 days of inactivity.1.8.12 Observability & KPIsEvents: notify.sent|failed|suppressed|quieted, notify.open|click (email), push.open, digest.sent, pref.changed, unsubscribe.KPIs: Delivery rate, open/click, push open rate, digest engagement, opt‑out rate, quiet‑hour suppression count, cost per 1k sends, notifications per booking.Alerts: bounce/complaint spikes, SES/Pinpoint errors, digest job failures, template compile errors.1.8.13 Work packages (Cursor 4‑agent lanes)Agent A — Data & API: DDL, GraphQL resolvers, preferences UI endpoints, consent ledger, device token flows.Agent B — Orchestrator & Templates: event routing, template registry, MJML compile pipeline, localization.Agent C — Delivery & Compliance: SES/Pinpoint integration, SPF/DKIM/DMARC setup, bounce/complaint handlers, suppression.Agent D — Digests & Quiet Hours: digest builder, timezone scheduling, quiet‑hour policy & exceptions, rate limits.1.8.14 TestsPreferences: toggle per‑event/channel; verify sends suppressed except required‑service.Quiet Hours: optional notifications delayed; exceptions still deliver; ICS present for reminders.Routing: booking confirmed/rescheduled → provider & buyer receive correct templates; Action Card expiries escalate during quiet hours.Digests: daily and weekly contain correct sections; de‑dup logic works; timezone windows honored.Deliverability: hard bounce/complaint suppresses future sends; ledger records action; banner prompts re‑confirm.Idempotency & rate limits: duplicate events do not re‑send; optional notification floods are throttled.Push tokens: invalid tokens cleaned; per‑device opt‑out honored.Security: no PII or NSFW previews leak in templates; deep links require auth.1.8.15 Artifacts (paste‑ready)db/migrations/018_notify.sql — tables above.api/schema/notify.graphql — queries/mutations above.services/notify/orchestrator.ts — event→audience→template routing skeleton.services/notify/providers/ses.ts & providers/pinpoint.ts — senders with retries/backoff.templates/email/*.mjml — compiled at publish; S3 cache.ops/runbooks/notify-bounce-complaint.md — immediate actions, suppression verification.observability/dashboards/notify.md — metric definitions & example queries.1.8.16 Acceptance criteria — mark §1.8 FINAL only when ALL trueUsers can manage per‑event/channel prefs and Quiet Hours; exceptions work as specified.Orchestrator consumes product events and dispatches email/push/in‑app with correct templates and localization.Transactional messages (receipts, booking, safety, payments) always deliver; optional messages respect prefs/quiet hours/digests.Deliverability is production‑ready (SPF/DKIM/DMARC set; bounce/complaint suppression active; warmup plan executed).Consent ledger records every opt action; unsubscribe links function; marketing remains OFF at MVP.Observability dashboards live; alerts wired; costs within plan (SES/Pinpoint pay‑as‑you‑go; idle scale‑to‑zero).§1.9 — Ratings, Reviews & Reputation — Gap Audit & FinalizationIn my prior §1.9 draft (mis‑numbered as 1.8), I delivered: verified‑booking‑only reviews, double‑blind publishing, SP‑level aggregates + Bayesian smoothing, provider‑level Reputation Score, Safe‑Mode on review media, moderation/reporting/DMCA, GraphQL, DDL, tests, KPIs, and acceptance.New items below close the last gaps I found when cross‑checking your non‑technical plan:A) Studios get their own reviews & aggregates (space‑scoped)Your plan states: Service reviews remain role‑scoped; Studio reviews are space‑scoped; no coupling of reviews between them. To reflect this:A.1 Delta DDL (add Studio review tables)db/migrations/018b_reviews_studios.sqlbegin;", "status": "todo", "agent": null, "priority": 136, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.10.8", "root": "WBS-1", "source": "TD", "title": "Quiet Hours (DND) & critical exceptionsUsers set a local window (e.g., 22:00–07:00). During Quiet Hours:Optional notifications are queued for digest or delayed until window end.Transactional non‑urgent items are delayed or delivered silently (in‑app only).Critical exceptions always deliver: booking.reminder_24h|1h, reschedule expiring in <6h (Action Card), payment.failed, payout.failed, safety.case.opened. Your plan requires “requests still deliver silently with summaries,” so we deliver in‑app banners and can email a summary if user enables exceptions. NonTechBlueprint1.10.9 Digests (daily/weekly)Builder runs per user’s timezone; assembles: new message requests, approvals pending, upcoming bookings (with ICS link), recent file uploads. This matches your “bundle every X hours unless ‘Booking day’ (then realtime).” NonTechBlueprintDe‑dup: if a transactional email already sent <N hours ago, include only a summary line.Opt‑in cadence: active users default to daily, low‑activity to weekly (user can change).1.10.10 Deliverability & suppressionDNS: SPF, DKIM, DMARC (start p=quarantine, move to p=reject post‑warmup).Warmup: ramp volumes using high‑engagement transactional email (booking & receipts) first.Feedback loops: SES webhooks write notify_consent(action='hard_bounce'|'complaint'); we suppress further sends and show an in‑app banner asking the user to reconfirm/email‑change.Link tracking: limited, never used on safety/IDV/legal mail.From/Reply‑To: consistent brand and SPF alignment.1.10.11 Security, privacy, complianceConsent ledger records every opt‑in/out/unsubscribe/resubscribe, with IP/UA and source; immutable.Required‑service emails (receipts, legal, security) cannot be disabled.Age/NSFW: never include NSFW previews in external channels; link to in‑app surfaces that honor Safe‑Mode defaults. (Your public surfaces are SFW by default.) NonTechBlueprint1.10.12 Rate limits & cost controlsPer‑user/channel token buckets for optional notifications; transactional exempt but idempotent.Monitor SES/Pinpoint spend; add an adapter for a secondary ESP if SES throttles.Register only active device tokens; expire tokens after 90 days of inactivity.1.10.13 Observability & KPIsEvents: notify.sent|failed|suppressed|quieted, notify.open|click (email), push.open, digest.sent, pref.changed, unsubscribe.Dashboards: delivery rate, open/click, push opens, digest engagement, opt‑out rate, quiet‑hour suppression count, cost/1k sends, notifications per booking.Alerts on spikes in bounces/complaints, template compile errors, digest failures.1.10.14 Work packages (Cursor — 4 agents)Agent A — Data & API: migrations, resolvers, consent ledger, prefs UI endpoints.Agent B — Orchestrator & Templates: event routing, MJML compile, localization scaffolding.Agent C — Delivery & Compliance: SES/Pinpoint integration, DNS, bounce/complaint handlers.Agent D — Digests & Quiet: digest builder, timezone scheduling, Quiet‑Hour logic & exceptions.1.10.15 Test planPreferences: toggle per‑event/channel; verify optional sends suppressed; required‑service still deliver.Quiet Hours: optional messages delayed; exceptions (booking reminders, reschedule expiring, payment/payout failure, safety) deliver immediately or as configured. NonTechBlueprintRouting: booking confirmed/rescheduled triggers correct templates to buyer & provider; Action Cards generate correct approvals/reschedule notices. NonTechBlueprintDigests: daily/weekly contain correct sections; “Booking day” bypass; de‑dup works. NonTechBlueprintDeliverability: bounces/complaints create suppression entries; subsequent sends are blocked; in‑app banner shows.Idempotency & rate limits: duplicate events do not re‑send; optional floods throttled.Push tokens: invalid tokens cleaned; per‑device opt‑out honored.Security: no PII or NSFW previews leak; deep links require auth and respect Safe‑Mode. NonTechBlueprint1.10.16 Acceptance criteria — mark §1.10 FINAL only when ALL trueUsers can manage per‑event, per‑channel preferences and Quiet Hours, including exceptions; changes persist and gate sends. NonTechBlueprintThe orchestrator consumes product events (messages, requests, approvals, reschedules, disputes, payments, payouts, uploads) and dispatches email/push/in‑app using active templates. NonTechBlueprintTransactional messages always deliver; optional messages respect prefs/Quiet Hours/digests.ICS export included for booking emails; reschedules update ICS. NonTechBlueprintDeliverability ready: SPF/DKIM/DMARC configured; bounce/complaint suppression active; warmup plan executed.Consent ledger immutable and queryable; unsubscribe functions correctly; marketing remains OFF at MVP.Observability dashboards/alerts live; costs remain within plan (serverless, pay‑as‑you‑go).§1.11 — Media & File Pipeline (Uploads, Processing, Delivery, Proofs & Deliverables) — Full Technical SpecPurpose. Provide a secure, cost‑efficient pipeline for images, video, audio, PDFs and in‑thread attachments used across: profiles/portfolios, Service Profiles, messaging & Action Cards (proofs/approvals, expenses), booking deliverables, and admin evidence. Enforce Safe‑Mode SFW on public surfaces, watermark & expiry for Proofs, virus‑scan everything, and keep costs elastic from build → launch → growth.1.11.1 Scope → TechnicalIngestion: direct‑to‑S3 presigned uploads (browser/mobile), resumable for large files, type/size validation, AV scan, EXIF/metadata extraction.Processing: image resize/crop/encode (WebP/AVIF + JPEG fallback), video transcode (HLS + MP4 fallback), thumbnails, watermarks, metadata tags, NSFW/Safe‑Mode classification.Delivery: CloudFront CDN with signed URLs, cache policies, range requests, hotlink protection.Product hooks: Profiles & SPs (§1.7), Messaging/Action Cards (§1.4), Booking Deliverables (§1.3), Reviews media (§1.9), Admin evidence (§1.5).Policies: Safe‑Mode defaults (public SFW only), proof galleries (watermarked, expiring), deliverable bundles (licensed, non‑watermarked), retention & legal hold.Cost posture: lifecycle to S3‑IA/Glacier, adaptive transcode ladder, dedupe, quotas, and throttles.1.11.2 Architecture (Amplify Gen‑2 posture)Frontend:Web (Next.js): Uploader component with chunk/resume, client crop, progress, and preflight checks (type/size).Mobile (React Native): native pickers + background upload w/ presigned URLs.Backend:AppSync GraphQL mutations for presign requests & completion acks.S3 buckets: media-raw (ingest), media-public (processed public), media-protected (processed private/proofs/deliverables), evidence (admin/legal).Processing Lambdas (S3 event → Step Functions): AV scan → image/video pipeline → Safe‑Mode classifier → metadata → publish.Video: AWS MediaConvert job templates (adaptive HLS ladder + progressive MP4).CDN: CloudFront distributions (public & protected origins) with URL‑signing for protected.Events: media.ingested, media.scanned, media.transcoded, media.classified, media.published, proofs.created, deliverable.published.Out‑of‑box modules (suggested/optional)FE uploader: Uppy or tus‑js‑client (resumable; OSS, highly customizable).Image processing: sharp (Lambda).AV scanning: ClamAV Lambda layer (common OSS pattern).NSFW/Safe‑Mode: light open‑source classifier for Tier‑0 + Rekognition for escalations (§1.5).", "status": "todo", "agent": null, "priority": 137, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.12.4", "root": "WBS-1", "source": "TD", "title": "GraphQL API (AppSync) — paste‑ready schemaCreate api/schema/calendar.graphql:type WeeklyRule {", "status": "todo", "agent": null, "priority": 138, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.13.4", "root": "WBS-1", "source": "TD", "title": "GraphQL API — schema artifactsCreate api/schema/payments.graphql:type PriceBreakdown {", "status": "todo", "agent": null, "priority": 139, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.14.4", "root": "WBS-1", "source": "TD", "title": "GraphQL API — paste‑ready schema (api/schema/orders.graphql)enum OrderState { CREATED AUTHORIZED CONFIRMED IN_PROGRESS COMPLETED CANCELLED DISPUTED CLOSED }", "status": "todo", "agent": null, "priority": 140, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.15.4", "root": "WBS-1", "source": "TD", "title": "GraphQL API (AppSync) — paste-ready schemaCreate api/schema/support_center.graphql:enum CaseKind { BOOKING PAYMENT PRODUCT DMCA POLICY CHARGEBACK }", "status": "todo", "agent": null, "priority": 141, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.17.11", "root": "WBS-1", "source": "TD", "title": "Public GraphQL & page APIs (read‑only)Paste‑ready: api/schema/seo.graphqltype LandingCopy { city: String!, role: String!, locale: String!, introMd: String!, bodyMd: String!, faqJson: AWSJSON!, updatedAt: AWSDateTime! }", "status": "todo", "agent": null, "priority": 142, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.20.4", "root": "WBS-1", "source": "TD", "title": "GraphQL API (AppSync) — paste‑ready schemaCreate api/schema/helpcenter.graphql:scalar AWSJSON", "status": "todo", "agent": null, "priority": 143, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.21.8", "root": "WBS-1", "source": "TD", "title": "Experimentation framework (productionized)Namespaces & configconfig/experiments/*.yaml with: exp_id, surface, variants, weights, targeting, primary_metric, guardrails.Assignment: hash(identity_id, exp_id) → bucket; persisted in dim_identity_traits.Exposure: fire exp.view when a variant first renders per session.Conversion: exp.convert on checkout.complete (default) or custom metric.Guardrails: SRM alert if assignment ratios deviate >2 p.p.; kill‑switch.EstimatorsCUPED for mean‑difference metrics; Bayesian beta‑binomial for rates.MDE calculator used before launch; sample size gate.Reporting: dbt builds fact_experiment_result with lift, p‑values/credible intervals, time‑to‑decision.ComplianceNo cloaking; crawler sees control variant for public SEO pages (§1.17).Experiments never change legal texts or consent components.1.21.9 Metrics catalogue (canonical definitions)Marketplace healthSearch→View CTR, View→Message rate, Message→CheckoutStart, CheckoutStart→Complete, Refund rate, Dispute rate, Chargeback win rate.Time to first booking (new profile/studio), Repeat booking rate (7/30/90).Supply freshness (updated in last 30 days), Availability coverage (slots next 14 days).GrowthEmail/digest CTR, alert CTR, referral qualification, ROAS (for promos §1.20).SEO: Non‑brand clicks, CTR on top 100 landings, indexation rate.SupportFRT/TTR, auto‑resolved %, DMCA cycle time, SLA breach count.Quality & safetySFW violation rate (public surfaces), doc verification lag, takedown propagation time.Standard SQL snippets are stored in analytics/metrics/*.sql and referenced by dashboards to avoid drift.1.21.10 Observability & reliabilityDrift: schema‑registry check fails CI if an event payload adds/removes required fields.Loss: compare app.start count vs. delivered events per time bucket; alarm if <95%.Lag: measure ingest→silver and silver→gold latencies; p95 budgets (e.g., 5 min / 30 min).Dead‑letter: invalid events go to s3://analytics/dlq/ with reason; daily triage.Dashboards: pipeline health, event volume by type, top schemas by change rate.1.21.11 Privacy, consent & DSARConsent stored per identity; marketing pixels fire only when consent.marketing=true.PII: disallow arbitrary PII keys; hardcoded allowlist only.DSAR delete: job scans identity_id and user_id across Bronze/Silver/Gold (including fact_experiments and fact_attribution_*) and replaces with tombstones; purge cache keys.Data retention: raw 25 months, derived 36 months (configurable).Access: RBAC via Lake Formation (read‑only analysts, restricted tables for Support/Finance with views).1.21.12 Cost postureIngest Lambda: low‑compute JSON validation; average <50ms; keep warm disabled.Storage: Parquet/Iceberg compression; partition pruning by event_dt.Transform: dbt on Athena (serverless) for daily models; Redshift Serverless only for high‑QPS dashboards.BI: QuickSight reader pricing or Superset (open‑source) to keep per‑seat cost low.Scale plan: if QPS or joins exceed Athena comfort, promote hot Gold models to Redshift materialized views.1.21.13 Suggested modules (open‑source/paid)Open‑source:PostHog (self‑hosted) for session/web analytics → forward to S3 (optional).Apache Superset for BI if you prefer OSS over QuickSight.dbt Core with dbt‑athena adapter for modeling.Paid (elastic, optional):QuickSight (pay‑per‑session) for exec dashboards.Mixpanel/Amplitude as a thin client layer while keeping S3 as source of truth (events dual‑written).If we disagree with using any suggested module later, we can substitute the AWS‑native path above with minimal friction.1.21.14 Work packages (Cursor — 4 agents)Agent A — Ingest & Contracts: API Gateway/Lambda /e, JSON schema registry & validator, Bronze S3 writer, DLQ.Agent B — Lake & Models: Iceberg tables, CTAS to Silver, dbt project for Gold (sessions, funnels, attribution, experiments).Agent C — Experiments: assignment, exposures, CUPED/Bayesian estimators, SRM alerts, results table & API.Agent D — Dashboards & Ops: QuickSight/Superset dashboards, pipeline health monitors, cost & lag alerts, DSAR delete job.1.21.15 Tests (representative)Schema validation: invalid payload rejected to DLQ; valid passes; contract version bump triggers CI fail until model updated.Identity stitch: login event links anon_id to user_id; downstream models show consolidated identity.Attribution: with and without click_token; last‑non‑direct logic; fraud filter removes repeated rapid clicks.Experiments: sticky assignment; SRM detection on skew; CUPED reduces variance vs. raw.End‑to‑end: search.query → result_click → profile.view → checkout.start → checkout.complete flows through to fact_orders within SLA.Privacy: DSAR removes identity across all layers; cache invalidated; reports show anonymized aggregates only.Cost: transforms finish within time window; BI queries respect partitions.1.21.16 Artifacts (paste‑ready)infra/analytics/ingest.yml — API Gateway + Lambda + Kinesis (optional) IaC.analytics/schema/events/*.json — event JSON Schemas (registry).db/migrations/028_analytics.sql — Athena/Iceberg table DDLs.analytics/dbt_project.yml & models/* — dbt project (sessions, funnels, attribution, experiments).services/experiments/* — assignment & estimators.observability/dashboards/analytics.md — pipeline & KPIs.ops/runbooks/analytics-pipeline.md — deploy, rollback, reprocess, and DR procedures.1.21.17 Acceptance criteria — mark §1.21 FINAL only when ALL true/e ingest live; events land in Bronze and are visible in Silver within ≤ 5 minutes (p95).Gold models (sessions, funnels, attribution, experiments) materialize daily; queries reproducibly compute KPIs.Attribution honors click‑token precedence and last‑non‑direct; fraud filters in place.Experiments operate with sticky assignment, SRM monitoring, CUPED/Bayesian estimators, and decision reports.Dashboards show marketplace & growth KPIs; pipeline health alarms live.Privacy: PII redaction, consent gating, and DSAR delete propagate across Bronze/Silver/Gold.Cost within budget (Athena/dbt primary; Redshift only for hot dashboards).§1.22 — Admin, Trust & Safety, and Back‑Office ConsoleFull Technical Development Plan (copy‑paste block for your master doc)Purpose. Provide a secure, auditable, and efficient internal console for Support, Trust & Safety, Finance, Content Editors, and City Ops. Power moderation, verification, refunds/chargebacks, suspensions, feature flags, and city‑level configs. Integrates with Orders & Refund Kernel (§1.14–§1.15), Studios Verification (§1.19), Search/Safe‑Mode (§1.18), Promotions (§1.20), Help Center (§1.20), and Analytics (§1.21). Built for Amplify Gen‑2 + AppSync + Aurora with serverless cost posture.1.22.1 Objectives & invariantsLeast privilege. Role‑based access with scoped permissions; sensitive actions require reason codes and dual controls where mandated.Full auditability. Every privileged read/write emits a WORM audit record with cryptographic chaining.Safety gates by default. SFW previews only; non‑SFW assets never render in public contexts; staff views are watermarked.Fast & decisive. One‑click macros for common actions (pause Instant Book, refund with kernel band, suspend user, DMCA takedown).Low cost. Static console (Next.js) + AppSync; no heavy third‑party admin frameworks.Ops‑ready. Dashboards, alerts, runbooks, and break‑glass flow are defined and tested.1.22.2 Roles & permissions (RBAC)Roles (suggested baseline):Admin: full system admin, can grant roles, edit city configs and feature flags.TrustSafety: moderation, DMCA, verification approvals, suspensions.SupportAgent: case handling, refunds (within policy bands), messaging escalations.Finance: payouts, adjustments, chargebacks, tax forms review.ContentEditor: Help Center authoring, public copy edits (SEO/Hreflang controls).CityOps: city‑level curation (Featured slots), spotlight toggles, local blackouts.ReadOnlyAuditor: read‑only access to investigate issues, no writes.Permission matrix examples (subset):orders.refund.apply → SupportAgent (≤ policy cap), Finance (> cap), Admin (override with 2‑man).accounts.suspend → TrustSafety, Admin (2‑man approval).studios.verify.approve → TrustSafety.promotions.city_config.edit → CityOps (within city), Admin (global).features.flags.edit → Admin only.help.publish → ContentEditor + policy approver.1.22.3 Data model (Aurora, schema admin) — paste‑ready DDLCreate db/migrations/029_admin_console.sql:begin;", "status": "todo", "agent": null, "priority": 144, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.22.4", "root": "WBS-1", "source": "TD", "title": "GraphQL (AppSync) — paste‑ready schemaCreate api/schema/admin.graphql:scalar AWSJSON", "status": "todo", "agent": null, "priority": 145, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.25.10", "root": "WBS-1", "source": "TD", "title": "Release qualification & sign‑offChecklists (per release):All coverage gates met; no critical a11y issues; perf budgets pass; security scans clean or accepted risks logged.Search freshness SLA verified; checkout success pipeline ≥ 99.5%.Feature flags toggled to “ramp” in Stage, then canary to Prod (10%→50%→100%).Roles: Engineering (tests pass), SRE (SLOs green), Trust & Safety (Safe‑Mode checks), Finance (payments ledger), PM (scope acceptance).Artifacts: ops/runbooks/release-checklist.md, ops/runbooks/rollback.md.1.25.11 Defect triage & SLAsSeverity levels: S1 blocking revenue/safety; S2 major; S3 minor; S4 cosmetic.SLA targets: S1 < 24h, S2 < 3d, S3 < 2w, S4 best‑effort.Labels: area:* (search, checkout, studios), type:bug|perf|a11y|security, sev:S1..S4, release-blocker.Escalation: S1 opens incident flow (§1.24.12); link bug → postmortem.Artifacts: ops/triage_policy.md, GitHub issue templates in .github/ISSUE_TEMPLATE/.1.25.12 Cost postureUnit/contract/service‑integration run on every PR; E2E only on labeled PRs or nightly for main to control minutes.Heavy k6 perf runs nightly/weekly only; dev perf smoke uses short ramps.Use parallel shards to cut wall time; cache npm and Playwright browsers.1.25.13 Work packages (Cursor — 4 agents)Agent A — Foundations: repo test scaffolds, Jest/TS config, coverage reporters, fixtures/seeders.Agent B — E2E & Visual: Playwright suite, visual snapshots on hero flows, a11y hooks.Agent C — Contracts & Perf: GraphQL/webhook contracts + k6 scenarios + budgets.Agent D — CI & Release: GitHub Actions workflows, coverage gates, preview deploy, release checklist & rollback hooks.1.25.14 Tests (representative)Booking kernel unit tests (min hours, overtime, deposits).Calendar buffers prevent overlaps; studio blackouts enforced.Safe‑Mode: NSFW never on public routes; OG/sharecards SFW only.Search ranking: verified/availability boosts within bounds; blocked/own profile excluded.Refund kernel time bands; Stripe webhook idempotency.Help deflection accounting; suggestions privacy (no email/phone tokens).Admin macros: DMCA takedown/restore logs + ISR revalidation.Analytics: click‑token precedence in attribution; experiment SRM alert on skew.Security: headers present; WAF blocks seeded attacks; no PII in logs.CWV budgets and API p95 respected on Stage; alerts open on regressions.1.25.15 Artifacts (paste‑ready)jest.config.ts, playwright.config.ts, axe.config.jstest/fixtures/*, e2e/specs/*, contracts/*, perf/k6/*.js.github/workflows/{build.yml,service-int.yml,e2e.yml,a11y.yml,perf-nightly.yml,release-qualify.yml}ops/runbooks/{test-data.md,release-checklist.md,rollback.md,triage_policy.md}1.25.16 Acceptance criteria — mark §1.25 FINAL only when ALL trueCI enforces coverage gates, a11y zero‑critical, contracts intact; failing gates block merge.E2E CUJs pass on Amplify Preview and Stage; traces and screenshots stored as artifacts.Perf budgets green (Stage p75 CWV & p95 API); k6 nightly runs succeed; regressions open issues automatically.Security/privacy checks pass (headers, WAF smoke, secret scan, no PII in logs).Release qualification checklist used on every Stage→Prod promotion; rollback runbook validated.Cost of CI kept in budget (E2E on demand + nightly; perf nightly/weekly).All artifacts and runbooks present in the repo.§1.26 — Mobile & PWA: Architecture, Offline, Push, Deep Links & Store ReadinessFull Technical Development Plan (single copy‑paste block for your master doc)Purpose. Deliver a cost‑efficient mobile experience that supports camera→upload, messaging, search/discovery, booking/checkout, help, and notifications, with offline resilience, deep linking, sharecards, and Safe‑Mode guarantees. Start with a PWA (Add‑to‑Home‑Screen) to keep costs low, while laying clean tracks to optional React Native (Expo) apps when growth and engagement justify it. Integrates with AppSync, Amplify Gen‑2, Stripe, Calendar/Orders (§1.12–§1.14), Notifications (§1.10), Media (§1.11), Search (§1.18), Help (§1.20), Analytics/Experiments (§1.21), and Security/Privacy (§1.24).1.26.1 Objectives & invariantsCost‑first: PWA for GA; native apps (Expo RN) are a phase‑gate option with shared GraphQL contracts.Offline‑friendly: browsing, composing drafts, and queued uploads continue without network.Push & deep links: web push where supported; native push when RN ships; deep/universal links map to the same routes as web.Media safety: camera uploads route through S3 pre‑signed URLs → moderation → SFW variants before public surfacing.No PII leakage: tokens in secure storage; logs sanitized; screenshots guarded where appropriate.One design system: mobile shares tokens/components with web (responsive first; RN subset mirrors tokens).1.26.2 Platform strategy & cost posturePhase‑1 (GA) — PWA only:Next.js app with Web App Manifest, Service Worker (Workbox) for caching and offline shell.Web Push: supported on Android/Chrome/Edge/Firefox; iOS Safari support exists but fragile—fallback to email/SMS when unsupported.Add‑to‑Home‑Screen prompt on repeat visits; maskable icons & splash.Phase‑2 (when metrics justify) — React Native (Expo) for iOS/Android:Reuse GraphQL models and auth; keep surfaces nearly isomorphic to web to minimize feature fork.Expo EAS for builds, OTA updates for non‑native code.Native Push via APNs/FCM; background upload workers; richer camera.Cost guardrail: we will not start native app work until PWA mobile p75 CWV is green and weekly active mobile users justify it (threshold set in §1.21 dashboards).1.26.3 App architecturePWA (web)Routing: /m/* routes mirror desktop; no separate codebase.Service Worker (SW):app-shell cache (stale‑while‑revalidate),help/* cached (1–7 days),API GETs for read‑only pages cached (1–5 min) with Safe‑Mode awareness (cache keys include sfw=1).Storage: IndexedDB via idb for drafts, outbox queue, and media chunk manifests.React Native (Expo, future)State: Apollo Client normalized cache + SQLite offline store.Background tasks: Expo Task Manager — periodic flush of outbox & upload chunks; resume on connectivity.1.26.4 GraphQL additions (device & push) — paste‑ready schemaCreate api/schema/device.graphql:enum DeviceKind { WEB_PWA IOS ANDROID }", "status": "todo", "agent": null, "priority": 146, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.26.6", "root": "WBS-1", "source": "TD", "title": "Camera & media uploads (mobile‑first flow)FlowClient requests pre‑signed URLs for a file (create “upload session” with chunk count & hashes).Client chunks (5–15 MB) and uploads directly to S3 with Content‑MD5.On complete, Lambda composes parts, strips EXIF (privacy), generates SFW variant (thumb/preview), and enqueues moderation (§1.24).When moderation passes, we publish asset to profile/work/gallery; otherwise stays private with reason banner.ResilienceChunk manifest stored in IndexedDB/SQLite; retries on network change; resume upload by chunk index.Progress events update UI; background tasks continue after app minimize (RN) or resume on next foreground (PWA).LimitsMax file size and max duration per media type; reject HEIC if web delivery needs conversion; server converts to AVIF/WebP/MP4 (h264/h265) for public SFW variants.1.26.7 Offline & outboxOutbox model (client): queue mutations (message.send, profile.edit, media.upload.complete, checkout.start) with conflict handling:Last‑write‑wins on idempotent edits;Merge for drafts;Abort for expired checkouts.Read caching: profile/studio pages & help articles cached; invalidate via SW message on publish events.Safe‑Mode when offline: render only SFW cached content; non‑SFW originals never cached.1.26.8 Notifications — mobile specifics (ties to §1.10)Web Push (PWA):Permission prompt only on user action (per standards).Topic bucketing by city, role, saved search, thread.Fallback to email/SMS when push unsupported or disabled.Native Push (Expo RN) (Phase‑2):APNs/FCM integration; background handlers update badges; deep link payload points to route.Preference center: surfaces device.pref with preview; honors quiet hours; emergency messages bypass per §1.10 policy.1.26.9 Deep links, sharecards & universal linksURL scheme: all share links are canonical web URLs (e.g., /@handle, /studio/{slug}, /work/{id}) with Open Graph tags (§1.16).Native routing (Phase‑2):iOS Universal Links: apple-app-site-association file;Android App Links: assetlinks.json.Fallback: if app not installed, links open web page (PWA).Deferred deep links: optional; track via click token (§1.21) and post‑install attribution.1.26.10 Authentication, security & privacy on mobilePWA: auth via HTTP‑only cookies; refresh via AppSync; no tokens in localStorage.RN: tokens in OS‑secure storage (Keychain/EncryptedSharedPreferences); device PIN/biometrics optional for step‑up.Logs: scrub emails/phones; redact EXIF on images; block screen capture on payment and IDV screens (RN).GDPR/DSAR: mobile honors DSAR deletions; clears caches/outbox; unregisters push tokens.1.26.11 Accessibility & UX standards (mobile)Tap targets ≥ 44px; focus order and visible focus; pref‑reduced motion; dark mode supported.ARIA roles & labels for interactive components; a11y audits in CI (axe for web; RN a11y checks).Language attribute reflects selected locale (§1.25); RTL scaffolding in place.1.26.12 Performance budgets (mobile)PWA CWV (p75, mobile): LCP ≤ 2.5s, INP ≤ 200ms, CLS ≤ 0.1.App start (RN): TTI ≤ 2.0s warm; <4.0s cold on test devices.Network: images lazy‑loaded; media placeholder skeletons; GraphQL persisted queries; gzip/brotli; HTTP/2 or HTTP/3.1.26.13 QA & device matrixDevice matrix (minimum):iOS: 2 recent iPhones (latest major −1), iPad (responsive checks).Android: 3 device classes (low, mid, high) across recent OS versions.Chrome/Edge/Firefox/Safari mobile for PWA.Automation:PWA: Playwright mobile emulation + Lighthouse CI for CWV.RN: Detox (Phase‑2) for critical flows; Maestro optional for cross‑platform flakiness.1.26.14 App store readiness (Phase‑2)Privacy manifests listing data categories; tracking only with consent.Sign‑in with Apple if other social logins are present (iOS policy).Testflight/Internal testing tracks; staged rollouts (5%→25%→100%); crash/error dashboards.1.26.15 Work packages (Cursor — 4 agents)Agent A — PWA Core: Service Worker, manifest, caching strategies, offline shell, A2HS prompts.Agent B — Media & Outbox: pre‑signed chunked uploads, resumable queue, EXIF strip, moderation hooks.Agent C — Push & Deep Links: device register GraphQL, prefs center, Web Push, deep link router; later APNs/FCM setup.Agent D — Quality & Perf: mobile CWV budgets/Lighthouse CI, a11y checks, device matrix & runbooks; RN Detox harness (Phase‑2).1.26.16 Tests (representative)Offline: cached pages render; drafts persist; outbox replays on reconnect.Uploads: chunk retries work; manifest survives app restarts; EXIF stripped; SFW variant used publicly.Push: device register/unregister; quiet hours honored; fallback to email/SMS when push off.Deep links: thread/profile/studio/work open correct route; app‑not‑installed → web fallback.Auth: cookie/session renewal works on PWA; RN secure storage persists tokens across restarts.A11y: no serious axe violations on mobile routes; RN components have labels & roles.Perf: CWV budgets green p75; RN TTI within target on matrix devices.Privacy: caches purged on logout/DSAR; no PII in client logs.1.26.17 Artifacts (paste‑ready)api/schema/device.graphql — device registration & prefs.db/migrations/033_device_push.sql — device tokens & prefs.web/public/manifest.webmanifest, web/sw.js — PWA shell.web/i18n/mobile.md — mobile copy keys & ICU notes.web/deeplinks/* — AASA & assetlinks templates.services/media/upload_session.ts — pre‑signed chunk flow..github/workflows/mobile-cwv.yml — Lighthouse CI for mobile routes.e2e/mobile/* — Playwright scripts; Detox harness (Phase‑2).1.26.18 Acceptance criteria — mark §1.26 FINAL only when ALL truePWA installs cleanly; offline shell & caching function; key mobile flows (search→book, message, help) work offline/spotty networks.Camera uploads are resumable; moderation & SFW variants enforced before public surfacing.Push works (web where supported); device tokens register/unregister; prefs & quiet hours honored; fallbacks active.Deep/universal links open correct routes; sharecards render SFW previews.A11y passes; CWV p75 and API p95 budgets green on mobile.RN scaffolding (if chosen) compiles; Detox smokes pass; store metadata prepared (Phase‑2).Cost posture remains within MVP budget (no native until metrics gate is met).§1.27 — Developer / Partner API & Webhooks (External Integrations, OAuth, Rate Limits & Docs)Full Technical Development Plan (single copy‑paste block for your master doc)Purpose. Enable vetted partners (agencies, CRMs, studio tools) to integrate with RastUp safely: read public inventory (profiles/studios/work), receive webhooks for bookings/messages, create invitations/briefs, and reconcile payouts—while protecting privacy, enforcing Safe‑Mode, and keeping costs elastic. Internally we stay GraphQL‑native; externally we expose a REST+Webhooks façade with OAuth 2.0.1.27.1 Scope & invariantsMusts: OAuth 2.0 (authorization code), signed webhooks with retries/Idempotency, least‑privilege scopes, Safe‑Mode on any public data, PII minimization (no emails/phones by default), and per‑partner rate limits.Won’ts (MVP): no partner write‑access to calendar or pricing; no bulk media uploads; no NSFW assets in any partner feed.Cost posture: API Gateway + Lambda + Aurora reads with caching; webhook delivery via EventBridge/Lambda; no persistent partner connections.1.27.2 External API surface (REST)Base URL: https://api.rastup.com/v1/Resources & verbs (MVP)GET /profiles — list public provider profiles (SFW‑safe): ?city=&role=&verified=&updated_after=GET /profiles/{id} — details (SFW fields only).GET /studios / GET /studios/{id} — public studio inventory (amenities, verified, hourly bands).GET /work / GET /work/{id} — SFW case studies.GET /orders/{id} — limited order view for the partner who originated a referral or has an authorized linkage (no PII by default).POST /briefs — create a buyer brief (RFP) with audience constraints; consumes buyer brief credits (§1.20).POST /invites — create invitation links for a target provider/studio (no auto‑accept).GET /payouts — partner‑scoped payout summaries for reconciliation (amounts, periods, IDs only).Query rulesAll list endpoints are cursor‑paginated (limit, cursor); cap limit to 100.Public queries enforce nsfw_band <= 1.Sort options: updated_at, rating (where available), published_at (work).Caching: CDN edge cache (60–300s) for unauthenticated public GETs.1.27.3 Authentication & authorization (OAuth 2.0)Auth server: Cognito (hosted UI for partner accounts) or custom OAuth on top of Cognito.Grant: Authorization Code + PKCE.Tokens: Access token (1 hour), Refresh token (30 days).Client types: confidential (server‑side apps) and public (limited, discouraged).Scopes (MVP):read:public_inventory — GET profiles/studios/work.write:briefs — POST briefs.write:invites — create invites.read:orders:linked — read orders that carry the partner’s referral id.read:payouts:self — payouts addressed to this partner account.Consent screen: shows scopes, privacy summary, link to partner terms.Artifactsapi/oauth/.well-known/openid-configurationapi/docs/scopes.md — human‑readable scope matrix and examples.1.27.4 Rate limits, quotas & abuse controlsDefault: 10 RPS burst, 2 RPS sustained per client, adjustable per partner plan.Quotas: 100k requests/day (public inventory); 5k webhook deliveries/day.Abuse: WAF allows only partner CIDRs optionally; anomaly detection → temporary blocks; 429 with Retry-After.Idempotency: all POST accept Idempotency-Key header; server stores 24h keys.1.27.5 Webhooks (events, security, retries)Event types (MVP)order.created|paid|cancelled|refunded (refund kernel results included).message.created (subject redacted; counts + IDs).brief.created|responses_threshold (when responses cross a threshold).payout.initiated|succeeded|failed.dmca.takedown|restore (only when partner previously ingested the asset via API/work feed).Security & deliveryHMAC‑SHA256 signature over raw body using shared secret; header: X-RastUp-Signature and X-RastUp-Timestamp.Reject if timestamp skew > 5 min.Retries: exponential backoff to 24h; DLQ after 10 attempts; replays available from Events API with pagination.Idempotency: partners must treat event id as unique; we never reorder within the same aggregate_id (order/thread).Artifactsapi/webhooks/signing.md — signature verification examples (TS, Python).contracts/webhooks/*.json — JSON Schemas (pinned by version).1.27.6 Versioning & compatibilityREST: URI‑level versioning (/v1/...); additive changes only in‑place; breaking changes via /v2.Webhooks: X-RastUp-Event-Version header; partners register accepted versions; we provide compat payloads for one version behind.Deprecation: 90‑day notice; email + dashboard banner + deprecation headers.1.27.7 Data model (Aurora) — partner registry & webhook endpointsdb/migrations/034_partner_api.sqlbegin;", "status": "todo", "agent": null, "priority": 147, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.27.8", "root": "WBS-1", "source": "TD", "title": "API Gateway, caching & search adapterGateway: REST API Gateway → Lambda (Node 20).Auth: OAuth introspection on bearer tokens; cache token verdicts in Redis/Dynamo (TTL 5–10m).Public GET caching: CloudFront edge cache; ETag + Last-Modified; Typesense adapter for text queries (SFW filter applied server‑side).Pagination: opaque cursor (base64 of index offset + filter hash); never expose internal IDs.1.27.9 Privacy & Safe‑ModeDefault PII policy: public inventory responses contain no emails/phones; city‑level only; exact addresses for studios only when partner has a contractual link (scope elevation).Safe‑Mode: all API responses include only SFW media URLs; NSFW never leaves the platform; webhooks never include raw media.Data Processing: partner registry tracks processor status and contact for DPA.1.27.10 Developer experience (DX) & docsDocs site: developers.rastup.com (static, versioned) with guides, auth flows, scopes matrix, and Try It consoles (read‑only keys).SDK stubs: TypeScript and Python minimal clients (generated from OpenAPI).Sandbox: Stage environment credentials; webhook event replayer with filters (date, event type, aggregate_id).Status page: incident history & uptime for API/Webhooks.Artifacts: api/openapi.yaml, sdk/ts/*, sdk/python/*, docs/developers/*.1.27.11 Observability, quotas & billing (if applicable later)Metrics: requests by route/partner, p95 latency, 4xx/5xx, quota usage, webhook success %, average retries.Alerts: spike in 5xx, partner over quota, delivery failure rate > X% in 10m.(Optional) Billing later: metered tiers tied to quotas; not in MVP.1.27.12 Work packages (Cursor — 4 agents)Agent A — OAuth & Registry: Cognito OAuth config, partner tables, scopes enforcement, token cache.Agent B — REST Endpoints: /profiles, /studios, /work, /briefs, /invites, /orders/{id}, /payouts.Agent C — Webhooks: endpoint CRUD, HMAC signing, retry & DLQ, replayer UI.Agent D — DX: OpenAPI, docs site, SDK stubs, examples, status page, Stage sandbox.1.27.13 Tests (representative)AuthZ: scope enforcement; least‑privilege; cross‑client isolation.Safe‑Mode: public inventory never returns NSFW assets; SFW thumbnails only.PII: emails/phones absent unless elevated scope; logs show redacted payloads.Idempotency: repeated POST with same key produces one result.Rate limits: exceeding quotas yields 429; Retry‑After respected.Webhooks: signature verification passes; replay detection; backoff after failures; replayer produces identical payloads.Versioning: v1/v2 route isolation; deprecation headers appear after toggles.1.27.14 Artifacts (paste‑ready)db/migrations/034_partner_api.sql — partner registry & webhook deliveries.api/openapi.yaml — REST contract.api/webhooks/signing.md — HMAC verification guides.services/webhooks/* — delivery/ retry/ DLQ/ replayer.services/rest/* — Lambda handlers per resource.docs/developers/* — guides, auth, scopes, examples.sdk/ts/*, sdk/python/* — minimal clients.observability/dashboards/partners.md — metrics & alerts.1.27.15 Acceptance criteria — mark §1.27 FINAL only when ALL trueOAuth 2.0 flows work; scopes enforced; token introspection/cache live.Public inventory endpoints respond with SFW content, cursor pagination, and edge caching.Briefs & invites can be created via API under correct scopes; buyer credits decrement where applicable.Webhooks deliver with signed payloads, retries, and replayer; partners can verify and replay.PII remains protected; elevated scopes audited; responses redacted by default.Observability dashboards & alerts are active; rate limits/quota enforcement tested.Docs site live; SDK stubs published; Stage sandbox usable end‑to‑end.Gate decision for §1.27 (your rule)I re‑audited §1.27 against your non‑technical plan’s partner/integration expectations (webhooks, OAuth, safe public inventory, briefs/invites, payouts reconciliation, privacy). With REST surface, OAuth/scopes, webhooks, data model, privacy, caching, DX, tests, artifacts, and acceptance specified, §1.27 meets the ≥99.9% bar and is implementation‑ready.§1.28 — User Data Export & Portability (Self‑Serve Exports, Receipts & Privacy Packs)Full Technical Development Plan (single copy‑paste block for your master doc)Purpose. Provide users with a complete, machine‑readable export of their data (GDPR Art. 20 “portability”) plus a human‑readable summary and official receipts/invoices. Use the same pipeline to fulfill DSAR exports (see §1.24), keep costs low (serverless), preserve Safe‑Mode and PII minimization, and ensure strong identity verification before release. Integrates with AppSync, Aurora, S3, Stripe, Messaging/Orders/Support (§§1.4, 1.13–1.15), Search/Analytics (§§1.18, 1.21), and Admin Console (§1.22).1.28.1 Objectives & invariantsPrivacy‑first: export only the requester’s data (and legally permitted conversation content), redact counterpart PII where required, never include secrets.Two artifacts per export:Portability bundle: JSON + CSV (UTF‑8), zipped with a manifest (SHA‑256 checksums).Human pack: PDF “Your RastUp data” summary + individual PDF receipts/invoices for orders.Strong verification: re‑auth + MFA (if enabled) + email confirmation before generation; single‑use, short‑TTL download tokens.Cost discipline: export runs as batched Lambdas, streams directly to S3 (no large temp storage), and auto‑expires in 7 days.SFW guarantee: public media in exports are SFW variants unless the user is the owner/uploader of an asset; never include NSFW for third‑party content.Completeness: covers identity, profile/studio, media metadata, calendar, orders/payments, messages, reviews, disputes/chargebacks, help/DMCA, analytics session metadata, and consent history.1.28.2 Export contents (canonical inventory)Identity & accountidentity.json: user_id, handles, names (if provided), locale, roles, verified flags, created/last_active.consent_history.json: marketing consent changes with timestamps & source.devices.csv: registered device tokens (token hashes only), push prefs, quiet hours.Profiles & studiosprofile.json: public fields, private notes the user wrote, uploaded media references (IDs, captions).studio.json: studio metadata, amenities, verification status (decision timestamps), public address (exact address included only if it is the user’s own studio).Calendar & availabilitycalendar_rules.json: buffers, minimums, blackouts. (No third‑party availability pulled in via ICS beyond free/busy summaries tied to the user’s account.)Orders & paymentsorders.csv: order_id, roles, counterpart masked ID, status, timestamps, subtotal/fees/taxes/total, refund summary.payouts.csv: payout_id, amounts, destination masked (last4 only), status.receipts/receipt_{order_id}.pdf: generated from Stripe data + our ledger (see 1.28.8).Messaging & actionsmessages/*.jsonl: one file per thread the user participated in; includes messages authored by the user in full and counterpart messages with PII‑redaction (emails/phones removed), plus message timestamps and delivery/read markers.Reviews & ratingsreviews_authored.csv and reviews_received.csv with rating, text, timestamps, and any moderation flags.Support, refunds & disputessupport_cases.csv, refunds.csv, chargebacks.csv (IDs, types, outcomes, timestamps, reason codes); evidence the user uploaded appears as S3 URLs with short‑TTL pre‑signed links.Mediamedia.csv: the user’s own uploads (IDs, titles, captions, SFW/NSFW band, sizes, checksums).media/ includes SFW variants for public items; originals only for assets uploaded by the user (not for third‑party images in chats).Search & analytics (privacy‑safe)search_history.csv: last 6 months of the user’s searches (query terms and city/role filters); no full clickstream.sessions.csv: session start/end timestamps, device class, coarse geo (country/city). No IP addresses stored.Attribution records for orders attributed to the user’s own clicks (source, medium, campaign, has_click_proof)—no partner secrets.Policy & DMCAdmca.csv: takedown requests initiated by the user; outcomes & timestamps.1.28.3 Data model (Aurora) — paste‑ready DDLCreate db/migrations/035_exports.sql:begin;", "status": "todo", "agent": null, "priority": 148, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
{"id": "WBS-1.28.4", "root": "WBS-1", "source": "TD", "title": "GraphQL (AppSync) — paste‑ready schemaCreate api/schema/exports.graphql:scalar AWSDateTime", "status": "todo", "agent": null, "priority": 149, "created_at": "2025-11-16T21:24:47Z", "updated_at": "2025-11-16T21:24:47Z", "nt_refs": [], "td_refs": []}
