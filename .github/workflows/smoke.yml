name: Orchestrator Smoke

on:
  workflow_dispatch:
  push:
    paths:
      - 'scripts/**'
      - 'orchestrator/**'
      - 'docs/blueprints/**'
      - 'ops/**'
      - '.github/workflows/smoke.yml'
  schedule:
    - cron: '23 03 * * *'  # nightly

permissions:
  contents: read

jobs:
  smoke-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Normalize line endings to LF in CI to avoid CRLF bash issues
      - name: Normalize LF for shell scripts
        run: sed -i 's/\r$//' scripts/smoke/agent1.sh

      - name: Run Agent-1 smoke (Linux)
        run: |
          bash scripts/smoke/agent1.sh
          cat docs/test-reports/smoke/agent1-linux.log

  smoke-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Agent-1 smoke (Windows)
        shell: pwsh
        run: |
          powershell -ExecutionPolicy Bypass -File scripts/smoke/agent1.ps1
          Get-Content .\docs\test-reports\smoke\agent1-windows.log

  concordance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Minimal concordance check (soft gate)
        run: python3 scripts/concordance/check_concordance.py
