name: Orchestrator Smoke
on:
  workflow_dispatch:
  push:
    paths:
      - 'scripts/smoke/**'
      - '.github/workflows/smoke.yml'

permissions:
  contents: read

jobs:
  smoke-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Agent-1 smoke (Linux)
        run: |
          bash scripts/smoke/agent1.sh
          cat docs/test-reports/smoke/agent1-linux.log
      - name: Upload smoke log (Linux)
        uses: actions/upload-artifact@v4
        with:
          name: smoke-linux-log
          path: docs/test-reports/smoke/agent1-linux.log

  smoke-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Agent-1 smoke (Windows)
        shell: pwsh
        run: |
          powershell -ExecutionPolicy Bypass -File scripts/smoke/agent1.ps1
          Get-Content .\docs\test-reports\smoke\agent1-windows.log
      - name: Upload smoke log (Windows)
        uses: actions/upload-artifact@v4
        with:
          name: smoke-windows-log
          path: docs/test-reports/smoke/agent1-windows.log
