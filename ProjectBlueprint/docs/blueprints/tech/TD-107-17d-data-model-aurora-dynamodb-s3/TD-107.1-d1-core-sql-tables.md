---
id: TD-107.1
title: "**D.1 Core SQL tables**"
source_doc: "TechDevBlueprint.docx"
source_path: "docs\blueprints\tech\TD-107-17d-data-model-aurora-dynamodb-s3\TD-107.1-d1-core-sql-tables.md"
parent_id: TD-107
anchor: "TD-107.1"
checksum: "sha256:25db8d42dc638c81feac20b6a673ff4d516166e7c13317272a8a01848e765b77"
last_modified: "2025-11-06T20:40:46Z"
doc_kind: "TD"
h_level: 3
---
<a id="TD-107.1"></a>
### **D.1 Core SQL tables**

*-- Advertiser (seller) settings*  
*create table promo_advertiser (*  
*advertiser_id text primary key, -- padv\_...*  
*user_id text not null, -- usr\_...*  
*default_payment_id text, -- Stripe customer/payment method (for postpaid or top-ups)*  
*status text not null check (status in ('active','paused','suspended')),*  
*created_at timestamptz not null default now(),*  
*updated_at timestamptz not null default now()*  
*);*  
  
*-- Campaigns (one per role/SP or studio)*  
*create table promo_campaign (*  
*campaign_id text primary key, -- pcmp\_...*  
*advertiser_id text not null references promo_advertiser(advertiser_id),*  
*target_entity_type text not null check (target_entity_type in ('service_profile','studio')),*  
*target_entity_id text not null, -- srv\_\* or std\_\**  
*name text not null,*  
*surface text not null check (surface in ('people_search','studio_search')),*  
*format text not null check (format in ('featured','boosted')),*  
*city_targets text\[\] not null, -- list of city codes*  
*keyword_targets text\[\] default '{}', -- optional*  
*status text not null check (status in ('draft','active','paused','ended','suspended')),*  
*start_date date not null,*  
*end_date date,*  
*cpc_cents int not null, -- flat CPC at MVP*  
*daily_budget_cents int not null,*  
*total_budget_cents int, -- optional cap*  
*pacing_mode text not null check (pacing_mode in ('even','accelerated')) default 'even',*  
*created_at timestamptz not null default now(),*  
*updated_at timestamptz not null default now()*  
*);*  
  
*-- Budget ledger (prepaid credits + spend)*  
*create table promo_budget_ledger (*  
*entry_id text primary key, -- pble\_...*  
*campaign_id text not null references promo_campaign(campaign_id) on delete cascade,*  
*kind text not null check (kind in ('topup','spend','credit','adjustment')),*  
*amount_cents int not null,*  
*processor text, -- 'stripe'*  
*processor_ref text, -- charge id, invoice id*  
*reason text,*  
*created_at timestamptz not null default now()*  
*);*  
  
*-- Impression & click logs (immutable, append-only)*  
*create table promo_event (*  
*event_id text primary key, -- pevt\_...*  
*campaign_id text not null,*  
*impression_id text not null, -- corr id across imp/click*  
*type text not null check (type in ('impression','click','invalid_click')),*  
*role text, -- role tab if surface=people*  
*city text not null,*  
*query_hash text not null, -- normalized query signature*  
*user_id text, -- viewer user (null if anon hashed)*  
*anon_fp_hash text, -- fingerprint hash for anon viewers*  
*ip_hash text not null,*  
*ua_hash text not null,*  
*ts timestamptz not null default now(),*  
*extra_json jsonb default '{}'::jsonb*  
*);*  
  
*-- Pricing & caps by city/role (admin configurable)*  
*create table promo_policy (*  
*policy_id text primary key, -- ppol\_...*  
*surface text not null,*  
*role text, -- nullable for studios*  
*city text not null,*  
*cpc_floor_cents int not null,*  
*max_density_top20 int not null, -- e.g., 2*  
*max_above_fold int not null, -- e.g., 1*  
*updated_at timestamptz not null default now()*  
*);*
