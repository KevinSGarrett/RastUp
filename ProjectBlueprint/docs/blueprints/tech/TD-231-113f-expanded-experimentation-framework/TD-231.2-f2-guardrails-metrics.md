---
id: TD-231.2
title: "**F.2 Guardrails & metrics**"
source_doc: "TechDevBlueprint.docx"
source_path: "docs\blueprints\tech\TD-231-113f-expanded-experimentation-framework\TD-231.2-f2-guardrails-metrics.md"
parent_id: TD-231
anchor: "TD-231.2"
checksum: "sha256:9c2ad26adcac74e1775d31beb12de2305232726e9dea1b2d6c9bab473e8c4c58"
last_modified: "2025-11-06T20:40:46Z"
doc_kind: "TD"
h_level: 3
---
<a id="TD-231.2"></a>
### **F.2 Guardrails & metrics**

- Guardrails computed **daily**:

  - Refund rate Δ vs control ≤ 0.2 pp
  - Complaint rate ≤ 0.1%
  - API p95 latency ≤ 2 s

- Metrics prepared in **Gold** as per‑variant aggregates with CUPED pre‑period covariates (e.g., prior 28‑day spend or visits).

**Example (Gold) CUPED prep**

*CREATE TABLE gold.exp_metric_checkout_cuped AS*  
*SELECT*  
*e.exp_key, e.variant, e.user_id,*  
*count_if(m.event='checkout.start') AS y_observed,*  
*-- theta estimate computed offline or via regression; simplified here*  
*avg(pre.y_baseline) as theta,*  
*(count_if(m.event='checkout.start') - avg(pre.y_baseline)) as y_cuped*  
*FROM dim_exposure e*  
*LEFT JOIN fact_events m ON e.user_id = m.user_id*  
*LEFT JOIN preperiod_agg pre ON e.user_id = pre.user_id*  
*WHERE e.exp_key='EXP_SEARCH_UI_A'*  
*GROUP BY 1,2,3;*
