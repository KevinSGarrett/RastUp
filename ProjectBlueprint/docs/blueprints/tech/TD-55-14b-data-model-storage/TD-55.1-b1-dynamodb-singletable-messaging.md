---
id: TD-55.1
title: "**B.1 DynamoDB single‑table (messaging)**"
source_doc: "TechDevBlueprint.docx"
source_path: "docs\blueprints\tech\TD-55-14b-data-model-storage\TD-55.1-b1-dynamodb-singletable-messaging.md"
parent_id: TD-55
anchor: "TD-55.1"
checksum: "sha256:cb5a0f11a4e19ab6412268ab94417f8c24e73d7bf60ff9d000e8c19bc925941f"
last_modified: "2025-11-06T20:40:46Z"
doc_kind: "TD"
h_level: 3
---
<a id="TD-55.1"></a>
### **B.1 DynamoDB single‑table (messaging)**

**Partition & sort:**

- **PK** = *THR#{threadId}*

- **SK**:

  - *THR* — thread metadata (one item)
  - *PART#{userId}* — participant membership & read cursors
  - *MSG#{ts}#{messageId}* — message frames (append‑only)
  - *CARD#{messageId}* — action‑card shadow (current state)
  - *TAB#{tab}* — project panel tab state (denormalized snapshot for fast read)

**Core items:**

- Thread (THR)

*{*  
*pk: "THR#thrd\_...",*  
*sk: "THR",*  
*kind: "inquiry\|project",*  
*lbgId: "lbg\_..." \| null,*  
*legId: "leg\_..." \| null,*  
*buyerUserId: "usr\_...",*  
*sellerUserId: "usr\_...",*  
*participants: \["usr\_...", "usr\_..."\],*  
*city: "Houston",*  
*createdAt, updatedAt,*  
*status: "open\|archived\|locked",*  
*lastMessageAt,*  
*safeModeRequired: true\|false*  
*}*  

- Participant (PART#user)

*{*  
*pk: "THR#thrd\_...",*  
*sk: "PART#usr\_...",*  
*roleContext: "buyer\|seller\|admin",*  
*lastReadMsgId: "msg\_...",*  
*lastReadAt,*  
*muted: bool,*  
*blockedUntil: ISO \| null*  
*}*  

- Message (MSG#ts#id)

*{*  
*pk: "THR#thrd\_...",*  
*sk: "MSG#2025-11-05T14:12:07.123Z#msg\_...",*  
*type: "text\|asset\|system\|action",*  
*body: "sanitized markdown or plaintext",*  
*attachments: \[ { kind: "preview\|manifest", s3Key\|manifestRef, mime, w, h } \],*  
*action: { type, payload, state, version } \| null,*  
*authorUserId: "usr\_...",*  
*nsfwBand: 0\|1\|2,*  
*flags: { moderation: "clean\|flagged\|blocked", policyHints: \[...\] },*  
*createdAt*  
*}*  

- Project Panel tab state (TAB#{tab})

  - *TAB#brief*, *TAB#moodboard*, *TAB#shotlist*, *TAB#files*, *TAB#docs*, *TAB#expenses*, *TAB#actions*  
    Snapshot JSON for fast open; canonical data lives in Aurora when contractual (docs, amendments, receipts).

**GSIs:**

- **GSI1 (inbox list)**: *GSI1PK = PARTICIPANT#usr\_...*, *GSI1SK = lastMessageAt desc → threadId* (materialized via write fan‑out).
- **GSI2 (project threads by lbg/leg)**: *GSI2PK = LBG#lbg\_...* or *LEG#leg\_...*, *GSI2SK = createdAt*.
