---
id: TD-261.1
title: "**1.14.8.1 Custom Request flow (Step Functions)**"
source_doc: "TechDevBlueprint.docx"
source_path: "docs\blueprints\tech\TD-261-1148-state-machines\TD-261.1-11481-custom-request-flow-step-functions.md"
parent_id: TD-261
anchor: "TD-261.1"
checksum: "sha256:4e284571e914026aae56eae92c983370028065fbba7755ba26176b563d1b6db6"
last_modified: "2025-11-06T20:40:46Z"
doc_kind: "TD"
h_level: 3
---
<a id="TD-261.1"></a>
### **1.14.8.1 Custom Request flow (Step Functions)**

*States:*  
*QuoteIssued -\> (BuyerAccept?) -\> PaymentIntentCreated -\> PaymentSucceeded*  
*-\> CreatorDelivers -\> (BuyerApproves? -\> Closed)*  
*-\> (BuyerRequestsRevision -\> CreatorDelivers) \[loop max N\]*  
*Cancelled/Refunded/Error (terminal)*  
*Guards:*  
* - IDV/age gates checked on every transition*  
* - Max revisions N configurable (default 2)*  
* - Auto-close after 7 days of inactivity post-delivery (no refund)*  

**Transitions (events & actions)**

- *BuyerAccept* → create PI; hold UI until Stripe returns *succeeded*.
- *PaymentSucceeded* → post system message, unlock **proofs**.
- *CreatorDelivers* → proofs posted; buyer can preview (watermarked).
- *BuyerApproves* → finals manifest recorded; receipt issued.
- *BuyerRequestsRevision* → loop with decrementing counter.
- *RefundIssued* → entitlements revoked; status *refunded*.
