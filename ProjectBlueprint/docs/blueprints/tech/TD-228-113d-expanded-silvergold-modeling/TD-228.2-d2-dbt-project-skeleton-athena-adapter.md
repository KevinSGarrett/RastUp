---
id: TD-228.2
title: "**D.2 dbt project skeleton (Athena adapter)**"
source_doc: "TechDevBlueprint.docx"
source_path: "docs\blueprints\tech\TD-228-113d-expanded-silvergold-modeling\TD-228.2-d2-dbt-project-skeleton-athena-adapter.md"
parent_id: TD-228
anchor: "TD-228.2"
checksum: "sha256:44e568332aab8642aed675c4d09c5c6520363a1af80bdb23e426a680a8625b8f"
last_modified: "2025-11-06T20:40:46Z"
doc_kind: "TD"
h_level: 3
---
<a id="TD-228.2"></a>
### **D.2 dbt project skeleton (Athena adapter)**

*/data/dbt_project.yml*

*name: rastup_analytics*  
*version: 1.0.0*  
*profile: rastup_athena*  
*model-paths: \["models"\]*  
*tests-paths: \["tests"\]*  
*vars:*  
*env: prod*  

*/data/models/silver/fact_promotions_events.sql*

*{{ config(materialized='incremental', unique_key='event_id', partition_by={'field': 'dt'}) }}*  
  
*with base as (*  
*select*  
*md5(concat(event, cast(received_at as varchar), coalesce(ids\['impression_id'\], ''), coalesce(ids\['campaign_id'\], ''))) as event_id,*  
*date_format(received_at, '%Y-%m-%d') as dt,*  
*event,*  
*received_at,*  
*ids\['impression_id'\] as impression_id,*  
*ids\['campaign_id'\] as campaign_id,*  
*city,*  
*context.role as role,*  
*json_extract_scalar(payload, '\$.invalid_reason') as invalid_reason*  
*from {{ ref('bronze_events') }}*  
*where env='{{ var("env") }}'*  
*and event in ('promo.impression','promo.click','promo.invalid_click')*  
*{% if is_incremental() %}*  
*and received_at \> (select coalesce(max(received_at), timestamp '1970-01-01') from {{ this }})*  
*{% endif %}*  
*)*  
*select \* from base;*  

*/data/models/gold/kpi_promo_ctr.sql*

*{{ config(materialized='table', partition_by={'field':'dt'}) }}*  
*select*  
*dt,*  
*campaign_id,*  
*count_if(event='promo.impression') as impressions,*  
*count_if(event='promo.click') as clicks,*  
*(count_if(event='promo.click') / nullif(count_if(event='promo.impression'),0)) as ctr*  
*from {{ ref('fact_promotions_events') }}*  
*group by 1,2;*  

*/data/models/schema.yml* (tests)

*version: 2*  
*models:*  
* - name: fact_promotions_events*  
*columns:*  
* - name: event_id*  
*tests: \[not_null, unique\]*  
* - name: kpi_promo_ctr*  
*columns:*  
* - name: dt*  
*tests: \[not_null\]*
